<!-- ch1-3_test.txt.md (8ページ、6200～9400字想定) -->
# 適切なマークアップ
<!-- リード文 -->
具体的にHTMLのマークアップを考えていくと、どのようにマークアップすることが適切なのか、という疑問にぶつかることがあると思います。ここでは、適切さのめやすと、適切なマークアップをする意義、そして適切にマークアップすることによって得られるメリットについて見ていくことにします。
## 適切なマークアップとは何か
読者の皆さんは、「適切な」あるいは「良い」マークアップとはどのようなものなのかと尋ねられたときに、どういった回答をするでしょうか。社内のコーディングルールに従っている、自分が思った通りにブラウザーに表示される<!--（あと1つぐらい、やや本質から離れた回答例を載せる？）、-->などでしょうか。もちろん、そのような視点も重要ですが、ここではより本質的に、純粋なマークアップとしてのHTMLに欠くことができないと考えられる4つの項目について、順に触れていきたいと思います。
### ルールに従っている
何かについてルールが決められているならば、そのルールに従うことは適切さのための重要な一歩です。もちろん、マークアップにもルールがあります。前節<!--この書き方でよい？-->でも触れたように、今日のHTMLのルールは、HTML Living Standardという仕様で決められています。
基本的にはこの仕様に従ってマークアップを行えばよいわけですが、1つ注意すべきポイントがあります。それは、HTML Living Standardがほぼ毎日のように、仕様のどこかに対して変更が提案される程度に議論が非常に活発だという点です。
もちろん仕様への提案のすべてが、新しい要素や属性に関する議論がなされているというわけではないのですが、技術の進化にあわせるようにルールは少しずつ、ときにはドラスティックに変化しています。
ですから、HTMLにある様々なルールに変更がないかどうかについて、読者の皆さんが持っている知識を不定期的にアップデートする必要があります。 そうすることで、最新のHTMLのルールに従ったマークアップをすることが可能になります。
<!-- このあたりが微妙で、本書の知識が時間の経過とともに陳腐化してしまうのは、紙の書籍の宿命なわけですが、果たして本書を自己否定するようなことを言い切ってしまってよいのか、についてはご相談させていただきたいところ。（言及するにしても、穏当な表現にする必要はある。）／変わらないところと変わるところ、といういい方も思い浮かびましたが、ではどこが変わっていなくてどこが変わっているのか、というのを示すことができないのでこれは回避したいところ。 -->
### HTMLチェッカーでエラーが報告されない
HTMLがルールに従っていることを確かめるためには、そのHTMLについてどのようにチェックすればよいのでしょうか。1つの方法としては、人間が目でチェックしていくことが考えられますが、サイトに存在する大量のページを人力のみでチェックすることは、現実味がないと言えるでしょう。また先に述べたように、HTMLのルールが変更されることがあるわけですから、人間の記憶にのみ頼ることは危険を孕んでいるとも言えます。
幸いなことに、HTMLは機械でチェックすることができます。古くから存在するHTMLを検証するサービスとしては、W3CのMarkup Validation Service[^1]<!-- 脚注記法はこれでOK? -->が有名です。このサービスは現在でも利用できますが、このサービスに取って代わる新しいHTMLチェッカーとしてNu Html Checker[^2]が現在開発されています。 このチェッカーは執筆時点で仕様の更新と歩調を合わせるようメンテナンスが続けられているので、チェックの結果が仕様の変更を反映していないという心配をする必要はないといえます。
ところで、世の中のウェブページでは、残念なことにHTMLチェッカーでチェックをしてみるとエラーが報告されることが珍しくありません。JavaScriptのようなプログラミング言語であれば、プログラムにエラーがあることはすなわち、プログラムが動作しないことを意味します。しかし、HTMLは、たとえエラーがあってもブラウザーがうまく解釈しようと試みるため、結果的にウェブページは何事もなかったかのように表示されるようになっています。<!-- という言い回しで適切かどうか。もし @bakera さんがノアの方舟の話を放り込むなら、ここで参照することもできるかと。 -->つまり、たとえエラーのあるHTMLがブラウザーで意図したとおりに表示されていたとしても、それは単にブラウザーがよしなに扱っているだけなのです。制作者は、意図したことを正確に伝えるためにも、エラーのないHTMLを作成する必要があります。
余談ですが、HTMLをNu Html Checkerでチェックすると、エラーとは別にワーニングが報告されることがあります。理想的にはワーニングも修正することが望ましいですが、必ずしもワーニングをゼロにすることに固執する必要はありません。ワーニングの表示内容をよく考えて、臨機応変に対応したいものです。 <!-- すこし突き放しすぎか。もう少しこの時はこうする、という個別論に踏み込んでもよいかもしれない、が1章ということを考えると、概論でもよいのかもしれません。 -->
[^1]: https://validator.w3.org/
[^2]: https://checker.html5.org/ nuとnewは奇しくも同じ発音ですから、そういった意味が込められているのでしょう。
### 意味のあるマークアップをする 
<!-- 「セマンティックスに沿う」 だと若干堅苦しいと判断。-->
<!-- この節は全体として書きかけの説明。文献調査をした上でブラッシュアップする必要あり。 -->
前述のHTMLチェッカーでエラーが報告さえされなければ、それでよいのでしょうか。そうであってほしいかもしれませんが、マークアップ言語は自然言語[^3]をマークアップするために多様なパターンがあり、コンテンツに依存する性質があります。つまり、コンテンツの内容や文脈に沿ったマークアップをする必要があるということです。よく言われるような、見出しは見出しとしてマークアップをするというのはこのことです。言い換えると、意味のあるマークアップをする必要があるということです。
この「意味のある」ものをセマンティックス（semantics）とも呼びます。先ほど挙げた見出しだけでなく、箇条書き、段落、ヘッダーやフッターなどといった文章の構成要素を、HTMLの要素や属性が持っているセマンティックスでもって適切に当てはめる必要があります。これは、現在の情報技術でコンピューターにさせることは困難を極めますので、人間が手でコンテンツの意味付けをしなければなりません。
ところで、マークアップで不適切な意味付けを行うことで、検索エンジンをだますことが技術的には可能です。かつて行われていた手法として、本来は見出しではないものに見出しとして過剰にマークアップするなどといったことが行われていました。しかし、このようにHTMLのセマンティックスを乱用することは、いたずらにソフトウェアを混乱させることになります。結果としてウェプページの閲覧者の不利益になるだけですから、このようなことはしてはなりません。
[^3]: プログラミング言語ではない、人間が使う言語。日本語が当てはまります。
### 適切なメタデータを加える
HTMLは、ウェブページ全体がどのようなコンテンツであるかをマークアップで端的に説明することができます。例えば、一般の書籍が本のタイトルを持つように、HTMLもまたタイトルを持つことができます。「名は体を表す」ということわざもありますが、適切なタイトルを付けることによって、そのページがどのような内容かをユーザーによりわかりやすく伝えることができます。ウェブは膨大な量の情報であふれかえっているわけですから、ページを見つけられやすくする工夫が必要とも言えるでしょう。
また、ページ内の特定の情報に関して、構造化データと呼ばれるメタデータを埋め込むことができます。これによって、検索エンジンへの検索結果に特別な情報を伝えたり、SNSサービスでそのページのURLを投稿した際にページの情報を補強したりすることも可能になります。<!-- あるいは、レスポンシブウェブデザインであれば、モバイル向けに適切な`meta`要素を設定する必要がある、とは書いたものの、これはいったん保留に？ -->

## なぜ適切なマークアップが必要か
前節では、適切なマークアップとはどのようなものかを説明しました。次に、適切なマークアップがどうして必要なのかを見ていきましょう。
### 人に優しく、自分に厳しく
ウェブからは離れますが1つの例として、他人に年賀状を送ることを想像してみてください。葉書を届けてもらうためには、葉書の表面に宛先の郵便番号、住所、氏名を正確に書く必要があります。これらを正しく書かなければ当然、年賀状は宛先に届くことはありません。ただし、郵便局は細かい番地や漢字の表記が多少間違っていても届けようとする努力はしてくれます。
これはインターネットの世界では、「送信するものに関しては厳密に、受信するものに関しては寛容に」というポステルの法則として知られています。この法則に従うと、情報の送信側となるHTML制作者は、厳密な仕様の遵守が求められることになります。また、受信側であるユーザーエージェントが壊れたHTMLでも読み込むことができるのも、この法則に従っておおらかにHTMLを解析していると解釈できます。受信側が寛容だからといって、送信側が厳密にデータを送信しなくてもよいということにならないのは、年賀状の例からも明らかです。
### 適切なDOMツリー構築のため
DOMというは、Document Object Modelの略であり、HTML文書をツリー構造として解析してオブジェクト化し、そのノードを操作することでHTMLを操作することのできるインターフェイスのことです。DOMツリーは可視化することができます（図参照）<!--図については現時点で割愛。-->。
DOMは、マークアップとスクリプトやプログラミング言語とをつなぐ橋渡しでもあります。特にJavaScriptでHTMLを操作することを考える場合に、より良く設計された適切なDOMツリーを用意することは、簡易な方法でDOMを操作することにつながります。 <!--DOM操作をしたいから `id` 属性を付与して、`document.getElementById`を使うよね、みたいなのがわかりやすいのか？-->

## 適切なマークアップで得られるメリット
ここまで、適切なマークアップをする必要性について見てきました。最後に、適切なマークアップをすることで得られるメリットについて見てみましょう。
### 相互運用性の向上
適切にマークアップをすることで、ウェブ制作者の意図するHTMLをルールにのっとったマークアップで表現することができます。その結果、ある特定のブラウザーの、特定のバージョンでのみ意図したとおりに動作するようなウェブページを避けることができます。言い換えると、ユーザーエージェントのメーカーやバージョンに依存しないウェブページを作成できるということです。 <!-- 正確には古いIEでHTML5の要素を認識できない、という問題は発生します…がもうhtml5shiv.jsの話とかしたくないですし、いまさら聞きたくないと思いますがいかがでしょうか。 -->
### パフォーマンスの向上
適切なマークアップは、エラーのないHTMLと言えます。エラーがないということは、HTMLを解釈するユーザーエージェントがエラーに出くわしたときに行う必要のある処理をすることなく、HTMLを処理することができるということです。つまり、エラーを処理するための時間を節約することができます。また、適切なマークアップは不必要に煩雑なマークアップを回避することにもなります。その結果としてマークアップを簡潔にすることにつながるため、HTMLファイルの容量の肥大化を防ぐことができます。
### メンテナンス性の向上
HTML仕様に従って作成されている適切なマークアップは、HTMLコードの見通しを良くし、将来への互換性を担保することができます。
見方を変えると、一定以上のHTMLコーディングスキルがあれば、どのような意図でマークアップしたのかが見えるようになる、ということができます。本書ではそのようなコーディングスキルを養うことを目標にしています。
### アクセシビリティの向上
適切なマークアップは、HTMLのもつポテンシャルを最大限に発揮することができます。アクセシビリティもHTMLのもつポテンシャルの1つです。アクセシビリティとは大雑把に言えば、情報へのアクセスのしやすさです[^4]。適切にマークアップを行うことで、コンテンツに存在する情報がどのようなものかを環境に依存しない形で伝えることができます。例えば、画像に対して適切な代替テキストを設定することで、画面を読み上げさせるスクリーンリーダーを使用した環境でも、制作者の意図した情報を伝えることができます。 また、そのような画像の代替テキストがあれば、速度の遅いモバイルネットワークのような通信環境の悪い状況でも、画像が表示されない代わりに代替テキストが表示されることでどのような画像なのかを認識することができます。<!-- ここでアクセシビリティツリーの話？ -->
[^4]: アクセシビリティに関するより詳しい説明については、『デザイニングWebアクセシビリティ』を参照ください。
### マシンリーダビリティの向上
適切なマークアップは、意味のあるマークアップであり、ユーザーエージェントが適切に解釈できるものでもあります。とりわけ、マシン（機械）であるサーチエンジンのクローラーに対しても有意義であると言えるでしょう。
前述のアクセシビリティと重なる面がありますが、画像と紐付いた代替テキストでもって、その画像がどのような画像なのかを機械も読むことができる、ということです。さらに、クローラーがページタイトルやリンクテキスト、あるいは構造化データなどと言ったマークアップの意味を通じて、コンテンツを解釈してくれるということにもつながります。
これはいわゆるSEO（サーチエンジン最適化）とも重なる部分があると言えます。適切にマークアップすることにより、サーチエンジンに対してより検索しやすいウェブページを提供することができるのです。

