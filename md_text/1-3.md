<!-- ch1-3_test.txt.md (8ページ、6200～9400字想定) -->
<!--
シンタックスとセマンティクスの説明をしておきたい
その二つを大きな軸にして再構成してみる
-->

# 適切なマークアップ
<!-- リード文 -->
実際にマークアップをするとき、どのようにマークアップすればよいのか迷う場面はしばしばあります。ここでは、適切なマークアップとは何かということと、その意義、メリットについて見ていきます。

## 適切なマークアップとは何か

「適切な」あるいは「正しい」マークアップとはどのようなものでしょうか。適切なHTMLと言えるかどうかは、本書ではわかりやすさのために、独自に3つのルールにわけて説明を試みます。その3つとは、字句的ルール、語彙的ルール、意味論的ルールです。

### 字句的ルール

先に説明した通り、HTMLは、テキストを機械にも理解しやすいようにしたものです。HTMLが利用される際は、プログラムがHTMLを読み取ることになります。HTMLを読み取って解析することを「パース」(parse)と言い、解析するプログラムを「パーサー」(parser)と言います。

パーサーがHTMLをパースするにあたり、HTMLがマークアップ言語のルールと照らし合わせて、文字単位で従っていることを求めるのが、字句的ルールとなります。

字句的ルールの主だったものを挙げますと、

- DOCTYPE宣言が“先頭に”記述されている
- タグのルールに従って要素と属性が記述されている
- 開始タグと終了タグは正しい入れ子構造になっている
- コメント（およびCDATAセクション）がルールに従って記述されている

といったものになります。詳しいルールの説明については、2章に譲ります。

### 語彙的ルール

マークアップ言語としての要件は字句的ルールで満たすことができますが、この状態ではHTMLとは言えません。HTMLであるためには、要素名や属性名、属性値がHTML仕様で定められたルールに語彙単位で形式的に従っていることが求められます。

これは言い換えると、パーサーが妥当なDOMツリーを生成するために必要な制約とも捉えることができます。

語彙的ルールの主だったものを挙げますと、

- ルート要素が`html`要素である
- 要素は仕様に定められた要素名を用いている
- 内容モデルの制約に従って、要素が記述されている
- 属性は仕様に定められた属性名を用いている
- 属性値が仕様によって限定される場合、その限定された属性値を記述している
- 要素と属性の組み合わせは、形式的に仕様に違反しない組み合わせになっている
- 仕様で定められた形式に従った要素の内容（コンテンツ）の記述が求められる場合、その形式に従っている

といったものになります。詳しいルールの説明については、主に3章で説明していきます。

### 意味論的ルール

HTMLが形式的に仕様に従っているだけでは、今日のHTML仕様を満たしているとは言えません。機械で判別できる語彙的ルールを超えて、人間が読んでも意味のあるマークアップになっていること、言い換えると文として意味をなす、矛盾がないことを求めます。これが意味論的ルールです。

これは、マークアップする内容が人間が読んで意味があり、内容の構造としてマークアップできるものになっていることが暗黙の前提条件となります。逆説的ではありますが、そもそも内容がマークアップできないものであるならば、適切なマークアップは不可能である、とも言えます。

意味論的ルールの主だったものを挙げますと、

- 内容に基づいた、適切な意味づけとなっている要素を選択している
- 要素の出現順序は、機械および人間が読んで意味に矛盾がないものになっている
- 属性値が自由記述である場合、機械および人間が読んで意味のある、矛盾しない属性値が記述されている
- 要素と属性の組み合わせは意味のあるものになっている

といったものになります。詳しくは語彙的ルールとあわせて、主に3章で説明していきます。





### シンタックス - 正しい文法で記述する

先に説明した通り、HTMLは、テキストを機械にも理解しやすいようにしたものです。HTMLが利用される際は、プログラムがHTMLを読み取ることになります。HTMLを読み取って解析することを「パース」(parse)と言い、解析するプログラムを「パーサー」(parser)と言います。

HTMLの記述の仕方にはルールがあり、文法が決められています。この文法を「シンタックス」(syntax) と言います。HTMLの文法は明確に定められており、今日では、「HTML Living Standard」という仕様で決められています。

基本的なHTMLの文法については、本書の2章と3章で触れます。

#### 文法エラー

HTMLをパースする際は、このルールに沿って解析していきます。記述がルールに沿っていないと、「文法エラー」(syntax error)となることがあります。文法エラーがあった場合、何が起きるでしょうか。

JavaScriptのようなプログラミング言語の場合、エラーがあると停止してしまい、何の処理も行われないのが普通です。

しかし、HTMLはプログラミング言語ではなく、テキストをマークアップした文書データです。マークアップが間違っていても、そのマークアップを無視してテキストを表示することができます。何も表示されないより、何らか表示された方が都合が良いため、ブラウザはエラーがあっても補正して表示しようと試みます。結果として、ウェブページはあたかもエラーがなかったかのように表示されることがあります。

逆に言えば、ブラウザで意図したとおりに表示されていたからと言って、エラーのないHTMLになっているとは言えないのです。

以前の仕様では、エラー時の挙動は明確に定められておらず、各ブラウザの実装に任されていました。そのため、エラー時の挙動はブラウザによる違いが大きく、特定のブラウザだけで全く表示されないこともよくありました。

現在の仕様では、多くのケースでエラー処理の方法が定められ、ブラウザごとの違いは小さくなりました。しかし、中には常識に反するような挙動が定められているケースもあり、予想に反する結果になることもあります。そのため、エラー処理に頼ることは望ましくありません。いくつかのケースについては本書の2章で説明しています。

#### 文法エラーをチェックする

ブラウザでの表示に問題がなくても、HTMLのシンタックスが適切とは言い切れません。では、どうすれば確認できるのでしょうか。

幸いなことに、HTMLの文法をチェックするツールが存在します。古くからあるサービスとしては、W3CのMarkup Validation Service[^1]が有名です。これは現在でも利用できますが、このサービスに取って代わる新しいHTMLチェッカーとしてNu Html Checker[^2]が現在開発されています。

HTMLをNu Html Checkerでチェックすると、エラーとは別に警告(Warning)が報告されることがあります。理想的には警告もすべて修正することが望ましいですが、必ずしもゼロにすることに固執する必要はありません。警告の表示内容を理解した上で、必要なものだけ対応すると良いでしょう。
[^1]: https://validator.w3.org/
[^2]: https://checker.html5.org/ nuとnewは奇しくも同じ発音ですから、そういった意味が込められているのでしょう。

### セマンティクス - 意味のあるマークアップをする

文法に問題がなければ、それだけで適切なHTMLだと言えるのでしょうか。文法には問題がなくても、適切でないケースがあります。前の節では、以下のようなマークアップの例を紹介しました。

```html
<h1>これは見出しのテキストのかたまりです</h1>
<p>これは本文です。この<mark>キーワード</mark>はこの文章で重要なものを表します。</p>
```

ここでは見出しを`h1`、本文を`p`というタグでマークアップしています。これを入れ替えるとどうなるでしょうか。

(よくない例)
```html
<p>これは見出しのテキストのかたまりです</p>
<h1>これは本文です。この<mark>キーワード</mark>はこの文章で重要なものを表します。</h1>
```

このマークアップは、文法エラーにはなりません。しかし、適切だとは言えないでしょう。見出しを本文として、本文を見出しとしてマークアップしてしまっているため、本来の意味が伝わらなくなっています。

マークアップ言語は、文書をマークアップして構造を明確にするものでした。言い換えると、マークアップによって、その部分の構造がどんな意味を持つものかを明確にするということです。

こうして表現される意味のことを「セマンティクス」（semantics）と呼びます。先ほど挙げた見出しや本文だけでなく、箇条書き、段落、ヘッダーやフッターといったさまざまな構成要素に対し、HTMLのマークアップを適切に当てはめることで、意味づけをして、セマンティクスが伝わるようにしていくのです。

#### メタデータを加える

マークアップでは、テキストの個々の部分のセマンティクスを表現します。それに加えて、ウェブページ全体に対してセマンティクスの情報を付け加えることもできます。

たとえば、書籍にタイトルがつけられているように、HTMLにもタイトルをつけることができます。ウェブは膨大な量の情報であふれかえっていますが、こういった追加の情報があれば、ページを探し出す際の手がかりになります。

ウェブページのコンテンツは、それ自体がデータです。タイトルは、そのデータが何であるか説明するデータです。あるデータを説明するデータ、すなわち、データのデータであると言えます。このようなものを「メタデータ」(meta data)と呼びます。情報の情報ととらえて「メタ情報」(meta information)と呼ぶこともあります。

メタデータはタイトル以外にもあります。たとえば、SNSでサムネイル画像を表示させるために使われる `<og:image>` というタグも、OGP(Open Graph Protocol)と呼ばれるメタデータを扱う仕組みの一つです。メタデータを記述する方法としては、他にも、JSON-LD (JSON for Linking Data) などがよく用いられています。このように、特定のフォーマットに基づいて構造化して記述したメタデータを「構造化データ」(structured data)と呼びます。

こういったメタデータによって、検索エンジンの検索結果に特別な情報を伝えたり、SNSサービスでそのページのURLを投稿した際にページの情報を補強したりすることが可能になります。

#### セマンティクスのエラー

シンタックスのエラーがツールで検出できるのに対して、セマンティクスの問題はツールでのチェックが困難です。

現在の情報技術では、コンピューターが文章の文脈から適切なセマンティクスを判断することはまだ難しい状態です。セマンティクスが適切かどうかは、残念ながら、人間の目で判断しなければなりません。

#### 機械をだますセマンティクス

時には、あえて不適切な意味付けを行い、機械をだますことも考えられます。

かつては、本来は見出しではないものを見出しとしてマークアップすることで、検索エンジンによるそのキーワードの評価を高め、検索上位表示を狙う、といったことが行われていたこともありました。

しかし、このようなHTMLのセマンティクスを濫用することは、いたずらにソフトウェアを混乱させることになります。これは結果としてウェプページの閲覧者の不利益になるだけです。現在では検索エンジン側の対策がなされ、そのようなマークアップに対してペナルティを与えることがあります。

## 適切なマークアップで得られるメリット

ここまで、適切なマークアップをする必要性について見てきました。最後に、適切なマークアップをすることで得られるメリットについて見てみましょう。

### 相互運用性の向上

適切にマークアップをすることで、ウェブ制作者の意図するHTMLをルールに則ったマークアップで表現することができます。その結果、ある特定のブラウザの、特定のバージョンでのみ意図したとおりに動作するようなウェブページを避けることができます。

言い換えると、ユーザーエージェントのベンダーやバージョンに依存しないウェブページを作成できるということです。現在のみならず、将来登場するかもしれないユーザーエージェントにも、正しく解釈してもらえることが期待できるでしょう。

### パフォーマンスの向上

適切なマークアップは、エラーのないHTMLと言えます。エラーがないということは、HTMLを解釈するユーザーエージェントがエラーに出くわしたときに行う必要のある処理をすることなく、HTMLを処理することができるということです。つまり、エラーを処理するためのリソースを節約することができます。

また、適切なマークアップは不必要に煩雑なマークアップを回避することにもなります。その結果としてマークアップを簡潔にすることにつながるため、HTMLファイルの容量の肥大化を防ぐことができます。

### メンテナンス性の向上

HTML仕様に従って作成されている適切なマークアップは、HTMLコードの見通しを良くし、将来への互換性を担保することができます。

見方を変えると、一定以上のHTMLコーディングスキルがあれば、どのような意図でマークアップしたのかが見えるようになる、ということができます。本書ではそのようなコーディングスキルを養うことも目標にしています。

### ウェブアクセシビリティの向上

適切なマークアップは、HTMLのもつポテンシャルを最大限に発揮することができます。ウェブアクセシビリティもHTMLのもつポテンシャルの1つです。ウェブアクセシビリティとは大雑把に言えば、ウェブ上の情報へのアクセスのしやすさです[^5]。適切にマークアップを行うことで、コンテンツに存在する情報がどのようなものかを環境に依存しない形で伝えることができます。

例えば、画像に対して適切な代替テキストを設定することで、画面を読み上げるスクリーンリーダーを使用した環境でも、制作者の意図した情報を伝えることができます。また、そのような画像の代替テキストがあれば、速度の遅いモバイルネットワークのような通信環境の悪い状況でも、画像が表示されない代わりに代替テキストが表示されることでどのような画像なのかを認識することができます。

[^5]: ウェブアクセシビリティに関するより詳しい説明については、『デザイニングWebアクセシビリティ』が参考になります。

### マシンリーダビリティの向上

適切なマークアップは、意味のあるマークアップであり、ユーザーエージェントが適切に解釈できるものでもあります。とりわけ、マシン（機械）であるサーチエンジンのクローラーに対しても有意義であると言えるでしょう。

前述のアクセシビリティと重なる面がありますが、画像と紐付いた代替テキストでもって、その画像がどのような画像なのかを機械も読むことができるということです。さらに、クローラーがページタイトルやリンクテキスト、あるいは構造化データなどと言ったマークアップの意味を通じて、コンテンツを解釈してくれるということにもつながります。

これはいわゆるSEO（サーチエンジン最適化）とも重なる部分があると言えます。適切にマークアップすることにより、サーチエンジンに対してより検索しやすいウェブページを提供することができるのです。

## コラム: 仕様のアップデート

基本的には仕様に従ってマークアップを行えばよいわけですが、1つ注意すべきポイントがあります。それは、HTML Living Standardがほぼ毎日のように、仕様のどこかに対して変更が提案される程度に議論が非常に活発だという点です。

もちろん仕様への提案のすべてが、新しい要素や属性に関する議論がなされているというわけではないのですが、技術の進化にあわせるようにルールは少しずつ、ときにはドラスティックに変化しています。

ですから、HTMLにある様々なルールに変更がないかどうかについて、読者の皆さんが持っている知識を不定期的にアップデートする必要があります。 そうすることで、最新のHTMLのルールに従ったマークアップをし続けることが可能になります。

## コラム: 人に優しく、自分に厳しく

インターネットの世界では、「送信するものに関しては厳密に、受信するものに関しては寛容に」という原則があります。これを「ポステルの法則」と言います。

ウェブからは離れますが、1つの例として、他人に葉書を郵送することを想像してみてください。葉書を届けてもらうためには、葉書の表面に宛先の郵便番号、住所、氏名を正確に書く必要があります。これらを正しく書かなければ、葉書が宛先に届くことはありません。しかし郵便局では、細かい番地や漢字の表記が多少間違っていても、なんとか届ける努力をしてくれるでしょう。

情報の送り手は正確に書く必要がある一方で、受け手側は、正確でなくても寛容に受け入れる努力をします。

HTMLの文法にもこの法則が適用されます。受信側であるユーザーエージェントは、壊れたHTMLでもおおらかに解析してくれます。しかし、受信側が寛容だからといって、送信側が厳密にデータを送信しなくてもよいということになりません。情報の送信側となるHTML制作者には、できるだけ厳密に仕様に従うことが求められるのです。
