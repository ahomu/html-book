# 2-2. HTMLの構文・発展編


2-1節では、HTMLの基本となる「タグ」の基本的な構文に触れました。
ここでは、タグの文法ルールの詳細や、タグ以外のマークアップについて触れていきます。

## HTML文書とDOCTYPE

HTMLを扱う際は、一つの文書に含まれるテキスト全てをマークアップして使ことが一般的です。このように、文書全体をHTMLとしてマークアップしたものを「HTML文書」(HTML document) と呼びます。

HTMLを文書全体としてではなく、一部分だけ切り出して扱うこともあります。たとえば、HTMLの部品を他の文書に埋め込むような想定のとき、部品の側はHTML文書全体ではなく、一部だけを含むものになります。このように切り出した一部分は、「HTML断片」(HTML fragment) と呼びます。

HTML文書の冒頭には、以下のようなマークを書く必要があります。これを「DOCTYPE」と呼びます。

```html
<!DOCTYPE html>
```

大文字・小文字は区別しないことになっていますので、小文字で書かれることもよくあります。

```html
<!doctype html>
```

DOCTYPEを書かない場合、この文書はHTML5ではない何かである可能性が高いと判断され、「奇癖モード」(quirks mode) で処理されることになります。

なお、DOCTYPEは「文書型宣言」(Document type declaration)と呼ばれることもありますが、これは古い呼び名です。かつてのHTMLはSGMLのルールに従っていたため、SGMLでは必須だった文書型宣言を書く必要がありました。HTML5はSGMLではなくなったため、文書型宣言も不要なのですが、ブラウザの互換性のために、文書型宣言と似た形の「DOCTYPE」を書くことになっています。

現在のDOCTYPEの記述は、SGMLの文書型宣言として正当な形にはなっていません。SGMLやXMLを出力するプログラム (XSLTプロセッサなど) でHTMLを生成しようとする際には、文書型宣言を省略したり変形したりできないこともあります。そのような場合のために、以下のような記述も許されています。

```html
<!DOCTYPE html ststem "about:legacy-compat">
```

これは冗長ですが、SGMLの文書型宣言としても適正な形になっています。前掲の簡単な形式が出力できない場合には、こちらを利用しても構いません。

## コメント

HTMLにはコメントを書くこともできます。コメントは以下のような形式です。

```html
<!--コメント-->
```

コメントと、コメントの中に含まれるテキストは、マークアップとしての意味を持ちません。DOMツリーでは要素やテキストノードではなく、コメントノードという独自のノードとして扱われます。表示には影響しませんが、JavaScriptなどからコメントノードの内容にアクセスすることはできます。

コメントは主に、HTMLのソースコードを読みやすくするために利用されます。ソースコード内のパーツの区切り示したり、div要素の終了タグがどの開始タグに対応するのかを書いたりすることができます。

```html
<!-- ヘッダー開始 -->
<div class="header">
...
<!--/header--></div>
<!-- ヘッダー終了 -->
```

### コメントの文法ルール

コメントにはさまざまな内容を入れることができます。
コメントには改行を含むことが許されるので、コメント内で改行して複数行のテキストを書くことができます。

```html
<!--
複数行にわたる
コメント
-->
```

コメントは空でも構いません。以下は有効なコメントで、内容が空のコメントノードができます。

```html
<!---->
```

コメントの中に `<` を書くこともできます。これはタグとはみなされず、そのままコメントノードの内容となります。既存のマークアップをコメントアウトするのに使われるのはよくあるパターンです。

```html
<!--
<h1>見出し</h1>
<p>テキスト</p>
-->
```

上記の通り、`>`を書くこともできるのですが、実は `>`はコメントの先頭に書くことができないという制限があります。コメントの先頭を`->`で始めることもできません。
以下は誤った例です。

```html
<!-->コメント-->
<!--->コメント-->
```

これはエラー(abrupt-closing-of-empty-comment parse error)となり、空のコメントノードが追加されます。「コメント-->」部分がコメントにならないことに注意してください。上記はいずれも、エラー処理によって、以下のようなマークアップと同じものとみなされます。

```html
<!---->コメント-->
```

### コメントは入れ子にできない

コメントの中に他のコメントを入れ子にすることはできません。以下はエラーとなる例です。

```html
<!-- 外側コメント前 <!--内側コメント--> 外側コメント後 -->
```

コメントの中に`<!--`を書くとエラー(nested-comment parse error)となりますが、単に`<!--`もコメントの一部とみなされます。また、`-->` をコメントの中に入れようとすると、そこでコメントが終了したものとみなされます。上記の例は結果としては、`外側コメント前<!--内側コメント`というコメントノードと、`外側コメント後-->`というテキストノードになります。

また、コメントの末尾に `<!-` を書くこともできません。以下は誤った例です。

```html
<!-- <!--->
```

これもコメントの中で別のコメントを入れ子にしようとしたものと解釈され、nested-comment parse errorとなります。

### コメントの前後にスペースを挟む

コメントの先頭に `>` `->` を書いたり、末尾に　`<!-` を書くとエラーになりますが、スペースを挟めば問題ありません。以下はいずれも正当なコメントです。

```html
<!-- >コメント -->
<!-- ->コメント -->
<!-- コメント<!- -->
```

コメントの前後にスペースを入れる習慣をつけておくと、エラーを避けやすくなります。
ただし、入れ子のコメントは書けませんので、以下の例はスペースがあってもエラーになってしまいます。

```html
<!-- <!-- -->
```

コメントの前後にスペースを入れると良い、ただし入れ子のコメントは書けない、と覚えておくと良いでしょう。

## Bogus Comment

HTMLには、さまざまな都合により、今では使われていないマークが入り込むことがあります。多くの場合、それらはコメントとみなされることになっています。このような、本来はコメントではなかったが、現在はコメントとみなされるものたちをBogus Commentと呼んでいます。Bogus Commentには以下のようなものがあります。

### マーク宣言

SGMLには`<!`ではじまる「マーク宣言」(Markup Declaration)と呼ばれるマークがあります。HTMLのコメントも、歴史的には「注釈宣言」と呼ばれるマーク宣言の一種でした。先に紹介したDOCTYPEも、元は文書型宣言と呼ばれるマーク宣言の一種でした。

現在のHTMLでは、マーク宣言は全てコメントとして扱われます。以下の記述は、XMLやSGMLにおいては実体宣言と解釈される可能性があるものです。

```xml
<!ENTITY external-file SYSTEM "external.xml">
```

HTML構文では、これは単なるコメントとみなされ、以下のようなマークアップと同じ意味になります。

```html
<!--ENTITY external-file SYSTEM "external.xml"-->
```

### 処理命令

SGMLやXMLには`<?` で始まる「処理命令」(Proccessing Instrument) と呼ばれるマークが存在します。もっとも有名なのは、XMLの先頭に書かれる「XML宣言」でしょう。

```xml
<?xml version="1.0" encoding="UTF-8" ?>
```

XMLに対してスタイルシートを指定するxml-stylesheet処理命令もしばしば見られます。

```xml
<?xml-stylesheet type="text/xsl" href="basic.xsl" ?>
```

これらはXMLやXHTMLで用いられた場合には意味を持ちますが、HTML構文では単にコメントとみなされます。以下のようなコメントが書かれているものと解釈されます。

```html
<!--xml version="1.0" encoding="UTF-8" -->
<!--xml-stylesheet type="text/xsl" href="basic.xsl" -->
```

### CDATA区間

SGMLやXMLには「CDATA区間」(CDATA Section)と呼ばれるマークがあります。特に、XHTMLにおいてscript要素と併用されるケースが見られました。

```xml
<script>
<!CDATA[[
 // JavaScriptのコード
]]>
</script>
```

これは、script要素内に出現した場合には、そのままスクリプトエンジンに送られます (そしてスクリプトエンジンの側で無視されます)。また、HTMLではないコンテキスト (たとえばsvg要素の中など) では本来のCDATA区間として解釈されます。そうでない場合、単にコメントとみなされます。

```html
<![CDATA[コメント]]>
```

HTMLのコンテキストで上記のCDATA区間が現れた場合、以下のようなコメントと同じ意味になります。

```html
<!--[CDATA[コメント]]-->
```

### 不正な終了タグ

タグ名は英大文字小文字(ASCII alpha)で始まらなければなりません。このルールは開始タグ、終了タグ両方に適用されます。
しかし面白いことに、これに違反した時のエラー処理は開始タグの場合と終了タグの場合とで異なり、開始タグのほうがテキストと見なされるのに対し、終了タグのほうは Bogus Comment とみなされます。

たとえば、以下のようなマークアップがあったとします。

```html
<42></42>
```

これはエラーとなりますが、エラー処理の結果、開始タグの方はそのままテキストとなり、終了タグのほうは中身部分がコメントとなります。つまり、以下のマークアップと同じように扱われることになります。

```html
&lt;42><!--42-->
```








## 文字参照

名前付き、十進、十六進








