<!-- ch4-2.txt (8ページ、3000～4600字x2想定) -->

## WAI-ARIA

この節では、とくにウェブアプリケーションをよりアクセシブルにする技術である、WAI-ARIAについて説明をします。

### WAI-ARIAとは何か

WAI-ARIAとは、W3Cによって策定された仕様の名称です。WAIを省略して、単にARIAとも呼ばれます。WIA-ARIAのWAIとは、Web Accessibility Initiativeの略称であり、W3C内部に存在するウェブアクセシビリティを推進する組織です。ARIAとは、Accessible Rich Internet Applicationsの略称です。

ARIAは、HTMLとJavaScriptとを組み合わせて作成される、特に動的なコンテンツや複雑なユーザーインターフェイスを持つウェブアプリケーションに対して、スクリーンリーダーに代表されるような支援技術が認識できるセマンティックスを追加することにより、ユーザーの理解を助けるものです。

以降の節では、ARIA仕様の概要、ARIAとその周辺に関するW3C文書の関係、ARIAロールの分類、およびその使い方について順に見ていくことにします。

### WAI-ARIAの概要

WAI-ARIAは主に、ロール、プロパティ、ステートという3つの機能をホスト言語に提供します。ロール、プロパティ、ステートについては、次のように説明されるものです。

- ロール：これは要素が何か、もしくは何をするかを定義します。`role`属性の値として与えることのできるものです。例えば、`role="navigation"`というロールは、`nav`要素と同じ意味を示します。また、`role="search"`というロールのように、HTMLそのものにはないロールもあります。
- プロパティ：これは要素の性質を定義し、追加のセマンティックを与えるために使用できます。例えば、`aria-required="true"`はフォームの`input`要素が必須であることを伝えます（HTMLの`required`属性と同じ意味）。また、`aria-labelledby="foo"`のように、IDとラベルを紐付けることができます。これにより、複数の場合も含めてページ内の他のどの要素からも`foo`として参照することを可能にします。これは `<label for="foo">`ではできません。
- ステート：これはプロパティの一種であり、要素の現在の状態を定義するものです。例えば、`aria-disabled="true"`は、指定された`input`要素が現在無効であることをスクリーンリーダーに対して伝えます。プロパティとステートの違いは、プロパティがアプリの状態遷移を通して変化しないのに対して、ステートはJavaScriptなどによって変更されるという点です。

#### ホスト言語とは

ホスト言語というのは、ARIAと組み合わせるマークアップ言語のことを指します。ARIA属性を追加できるマークアップ言語であれば、どのようなものでもホスト言語になりえますが、ウェブにおいては、HTMLがホスト言語になることがほとんどです（SVGがホスト言語になることもあります）。以降の節では、HTMLがホスト言語であると仮定して話を進めることにします。

### ARIAとその周辺仕様との関係

WAI-ARIAには多数のロール、プロパティ、ステートが定義されていますが、そのすべてがHTMLで使えるということにはなりません。

わかりやすさのために、まずロールに限った話をしますと、例えば、一般的なロールの概念を定義する、抽象ロールと呼ばれる種類のロールがあります。これは上位の概念を表すロールなので、コンテンツで使用しません。抽象ロール以外の分類としては、ウィジェットロール、文書構造ロール、ランドマークロール、ライブ領域ロール、ウィンドウロールという分類がWAI-ARIA仕様でなされています。

HTMLがホスト言語の場合、HTML要素自体がセマンティックスを持っているため（例えば、`h1`要素が見出しであることは、改めて説明するまでもないでしょう）、ある要素に対して特定のロール、プロパティ、ステートの組み合わせしか受け付けません。

では、具体的にどのHTMLの要素や属性とWAI-ARIAのロール、プロパティ、ステートとを組み合わせることができるのでしょうか。組み合わせについては、ARIA in HTML[^1]という仕様で現在定義されています。つまり、ARIA in HTML仕様は、WAI-ARIAとHTML仕様の仲立ちをしていると言えます。3つの仕様の関係を図示すると、次のようになります。

[^1]: https://www.w3.org/TR/html-aria/

![WAI-ARIA、ARIA in HTML、HTMLの関係図](../img/4-2-01.png)
図 4-2-1 WAI-ARIA、ARIA in HTML、HTMLの関係

WAI-ARIAとHTMLとの関係は前述のようになりますが、より実践的なシーンでどのようにARIAを活用するのかという例示が、WAI-ARIA Authoring Practices[^2]というW3Cのノートに示されています。フォームのチェックボックスやスライダーなどといった具体的なデザインパターンやウィジェットの例がありますので、参考になるでしょう。

[^2]: https://www.w3.org/TR/wai-aria-practices/

また、ARIAに関連する、ウェブ開発者よりもむしろブラウザーや支援技術の開発者向けの仕様として、Core Accessibility API Mappings[^3]やHTML Accessibility API Mappings[^4]というプラットフォームAPIとの対応を示した仕様や、Accessible Name and Description Computation[^5]という名前やラベルなどの優先順位を決める仕様が、WAI-ARIAスイートとして位置づけられています。

[^3]: https://www.w3.org/TR/core-aam/

[^4]: https://www.w3.org/TR/html-aam/

[^5]: https://www.w3.org/TR/accname/

さらに、WAI-ARIA仕様の拡張として、EPUBのためのDPUB-ARIA[^6]、SVGのためのSVG Accessibility API Mappings[^7]というような仕様もあります。

[^6]: Digital Publishing WAI-ARIA Module https://www.w3.org/TR/dpub-aria/

[^7]: https://www.w3.org/TR/svg-aam/

最後に、DOMとの関連づけとして、IDLインターフェイスがWAI-ARIA 1.2から定義されるようになりました。これにより、JavaScriptでより容易にARIAプロパティやステートを操作できることが期待されます。<!--本当にこれでいいのか-->

### ARIAの使い方

前節では、ARIAとその関連仕様について説明していきましたが、具体的にどのようにARIAをHTMLで使用すればよいのかの説明をこの節では行います。W3CのノートにUsing ARIA[^8]という文書があり、この文書の中でARIAの5つのルールが挙げられていますので、順を追って説明します。

[^8]: https://www.w3.org/TR/using-aria/

<!-- 参考訳：Using WAI-ARIA in HTML（日本語訳）https://imagedrive.github.io/spec/using_wai-aria_in_html.xhtml -->

<!--1～5はままコピーあり-->
#### ARIAルール1. HTML自身に備わっている機能を利用する

ホスト言語、すなわちHTMLに元々備わっている（ネイティブ）機能が、ARIAのロールやプロパティ、ステートと同じ意味を持つのであれば、HTMLに備わったものを使用します。

例えば、HTMLでは見出しの要素があるので、ARIAを用いずにHTMLの見出し要素を用います。

#### ARIAルール2. HTMLのネイティブのセマンティックスを変更しない

むやみにHTMLネイティブのセマンティックスを変更してはなりません。例えば、次のようなマークアップは不適切です。

``` 不適切例
<h1 role=button>heading button</h1>
```

これは、次のようにするのが適切です。

``` 適切例
<h1><button>heading button</button></h1>
```

何らかの理由で正しい要素を選択できない場合、次のようにします。

``` 代替マークアップ例
<h1><span role=button>heading button</span></h1>
```

#### ARIAルール3. ウィジェットのコントロールはキーボード操作可能にする

ユーザーが、クリック、タップ、ドラッグ、ドロップ、スライド、スクロールできるウィジェットを制作した場合、ユーザーがキーボードを使用することで、ウィジェットへの移動および同等のアクションの実行も可能でなければなりません。

例えば、`role=button`を使用する要素は、適切にフォーカスできなければなりません。また、ユーザーが、<kbd>Enter</kbd>キー（Win OS）または<kbd>Return</kbd>キー（Mac OS）と<kbd>space</kbd>キーの両方を使用する要素に関連したアクションをアクティブにできなければなりません。

#### ARIAルール4. 可視のフォーカス可能な要素を無効にしない

可視のフォーカス可能な要素に`role="presentation"`や`aria-hidden="true"`を使用してはなりません。

フォーカス可能な要素にこれらを使用すると、支援技術のユーザーに対して「何もない」要素にフォーカスを当てることになるためです。

#### ARIAルール5. インタラクティブな要素にアクセシブルな名前を持たせる

すべてのインタラクティブな要素は、アクセシブルな名前（accessible name）を持たなければなりません（アクセシブルな名前については、後で説明します）。例えば、次のコード例の`input`要素は、目に見えるラベル「ユーザー名」を持っていますが、アクセシブルな名前は持っていません。

``` 不適切な例
<span>ユーザー名</span> <input type="text">
```

これは、次のように適切なマークアップをすることで、`input`要素のアクセシブルな名前が「user name」であることを支援技術に伝えることができます。

```
<label>ユーザー名 <input type="text"></label><!-- OK例 -->
<label for="uname">ユーザー名</label> <input type="text" id="uname"><!--これもOK-->
```

### ARIAロールの分類とその説明

この節では、ARIAロールについてどのようなものがあるのか、分類を通して詳しく見ていきたいと思います。

ARIAロールはWAI-ARIA仕様で定義され、`role`属性の属性値として使用することができます。たとえば、次のように:

```
<div role="presentation">うんたらかんたら</div>
```

仕様において、ロールは次の6つに分類されます。執筆時点で最新のW3C勧告である、WAI-ARIA 1.1によれば、全部で81あります[^9]。81という結構な数が定義されているために、その全部のロールを紹介することはできませんので、ここでは個別のロールの説明に立ち入ることなく、分類の説明をするに留めます。

[^9]: 総数と個別の数が一致しないのは、`separator`ロールがフォーカス可能な場合にウィジェットロール、フォーカス可能でない場合に文書構造ロールに分類されるためです。

- 抽象ロールは他のロールの上位概念を定義するために設けられたロールです。そのため、文書の中で使用してはなりません。抽象ロールは12個定義されています。
- ウィジェットロールは、ユーザーインターフェイスウィジェットとして機能するものです。`button`や`combobox`など、29のロールが定義されています。
- 文書構造ロールは、ページでコンテンツの構造を説明するものです。通常インタラクティブではない状態になります。`heading`や`presentation`など、26のロールが定義されています。
- ランドマークロールは、ナビゲーションランドマークを意図するページの領域を示すものです。`main`や`navigation`など、8つのロールが定義されています。
- ライブ領域ロールのライブ領域とは、外部イベントの結果として更新されるウェブページの領域と定義されています。例としては、株価の表示や、ゲームのスコア表示部分が挙げられます。
- ウィンドウロールは、ブラウザーやアプリケーション内でウィンドウとして機能するものです。`alertdialog`と`dialog`の2つが定義されています。



#### ネイティブセマンティクスについて

ここで、WAI-ARIAから少しだけ離れて、HTMLを思い出してみましょう。

本書でこれまでに説明してきたように、HTMLの要素はHTML仕様で定義されたセマンティクスを持ちます。これは例えば、`h1`要素であればランク1の見出しを表し、`main`要素であれば、主要なコンテンツを表します。このように、HTML自身がもつ要素の意味を、WAI-ARIAではホスト言語のセマンティクスやネイティブセマンティクスなどと呼びます[^10]。

[^10]: やや曖昧に書いていますが、明確に用語として定義されていない、という事情によります。

一方で、WAI-ARIAはロールでセマンティクスを表すことができます。例えば、`heading`ロールであれば見出しを、`main`ロールであれば文書の主要なコンテンツを表します。

言い換えると、`h1`要素と`heading`ロール、`main`要素と`main`ロールは、ホスト言語であるHTMLのネイティブセマンティクスと、WAI-ARIAセマンティックスで同じ意味を示すことになります。

```
<div role="main">主要なコンテンツ…</div><!-- WAI-ARIAセマンティクスによる表現 -->
<main>主要なコンテンツ...</div><!-- HTMLネイティブセマンティクスによる表現 -->
```

ところで、ネイティブセマンティクスとWAI-ARIAセマンティックスとを同時に使用することで、セマンティクスが冗長になるという状況が起こりえます。このような状況で、ホスト言語の機能が暗黙のWAI-ARIAセマンティクスを持つと呼びます。

ここで、ARIAの使い方で示した「ARIAルール1. HTML自身に備わっている機能を利用する」を思い出してください。これは、わざわざ暗黙のWAI-ARIAセマンティクスを持ったHTMLについては、ARIAを使うことなくHTMLネイティブの機能を使用するように求めている、と言い換えることができます。つまり、HTMLコードで示すと次のようになります。

```
<div role="main">主要なコンテンツ…</div><!-- こうすべきでなく -->
<main>主要なコンテンツ...</div><!-- このように表現すべき -->
```

これは、WAI-ARIAの使いどころが制限されるということになります。つまり、そもそもHTMLにネイティブセマンティクスが存在しない、またはCSSやJavaScriptとの関係性のために既存のウェブサイトで要素を書き換えることができない場合に限って、ARIAロールでセマンティクスを表現すべき、ということになります。

このARIAセマンティクスとHTMLのネイティブセマンティクスの関係を規定しているのが、ARIA in HTML仕様になります。このARIA in HTML仕様を参照することで、利用しようとしているARIAセマンティクスが既にHTMLネイティブに存在するかどうかを確かめることができるのです。


#### ロール`presentation`と`none`について

HTMLのほとんどの要素はセマンティクスを備えていますが、ロール`presentation`と`none`は他のロールとは違い、セマンティクスを打ち消す働きをします。

`presentation`と`none`は同じ働きをします。同じものが2つある理由としては、`role="presentation"`が`aria-hidden="true"`と同じ働きをすると誤解する人が多かったために、後からより意味が明確である`role="none"`が追加されたという経緯によります。`none`が十分にサポートされない間は、`role="none presentation"`と重複して使用するのが良いでしょう。

さて、このロール`presentation`と`none`の使いどころですが、古いウェブページにおいて、純粋に装飾的な画像（いわゆるスペーサー画像）に対して、またはいわゆるテーブルレイアウト（CSSのブラウザーサポートが貧弱だった時代に、`table`要素を用いてページレイアウトを実現する手法）に対して利用するというシーンを挙げることができます。その要素が画像であったり、表であったりという意味を打ち消すことによって、単なる見栄えのための要素であることを明示できます。

```
<img alt="" src="spacer.png" role="presentation none"><!-- 純粋に装飾的であることをARIAロールで補強 -->
```

`img`要素にロール`presentation`と`none`を使用する場合、`alt`属性の値は空である必要があります。（代替テキストを持つ画像であれば、その画像に意味があることになりますから、`presentation`や`none`と意味が矛盾してしまうためです。）

テーブルに対して使用する場合、`table`要素に`role="none presentation"`を指定すれば、子孫の要素に継承されます。ただし、入れ子になった`table`には継承されません。

```
<table role="none presentation">
<tr>
<td><abbr>W3C</abbr> 
<tr>
</table>
```
<!--  https://www.w3.org/TR/using-aria/#ariapresentation にある画像と似たようなものを張って付けておく-->

### プロパティとステートについて

プロパティとステートは似た性質を持つこともあり、ARIA仕様では一括りにして扱われています。プロパティとステートは、ウィジェット属性、ライブ領域属性、ドラッグアンドドロップ属性、関係属性の4つに分類されています。

- ウィジェット属性。ユーザー入力などの動作を受け取るGUIシステム上や、リッチなインターネットアプリケーションに見られるユーザーインターフェイス要素に固有の属性が分類されます。ラベル付けのために使用される`aria-label`属性のような、HTMLのフォームに関連する24の属性が含まれています。
- ライブ領域属性。ライブ領域というのは、リアルタイムの株価更新や、チャットのログなどが例として挙げられるものです。要素が更新されることを示す`aria-live`属性のような4つの属性が分類されます。
- ドラッグアンドドロップ属性。ドラッグアンドドロップのインターフェイス要素に関する情報を示す属性です。`aria-dropeffect`属性と`aria-grabbed`属性の2つが分類されています。
- 関係属性。文書構造から単純に決定できない要素間の関係や関連性を示す属性です。列をカウントする`aria-colcount`属性などの16の属性が分類されます。

### 名前計算について？

Accessible Name and Description specificationの説明はあるとよいか？

### ARIAのラベルと関係性？

https://developers.google.com/web/fundamentals/accessibility/semantics-aria/aria-labels-and-relationships?hl=ja
の解説を借りてくる？
