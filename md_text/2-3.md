# URL

HTMLの属性には、属性値としてURLを指定するものが多数あります。ここでは、URLの書式について説明します。

## URLの基本書式

属性の中には、値としてURLを指定するものがあります。代表例は`a`要素の`href`属性です。

```html
<a href="https://www.w3.org/">W3C</a>
```

URLは、リソースの場所を特定するための汎用的な識別子です。URLの詳細は[URL Standard](https://url.spec.whatwg.org/)というドキュメントにまとまっていますので、詳しく知りたい方はこちらをご覧ください。

URLと言ってまず連想されるのは、"https:"ではじまる形式のものでしょう。

```text
https://example.com/
```

上記はシンプルな例ですが、もう少し複雑な例もあります。

```text
https://example.com:443/foo/bar.php?q=xxx#result
```

### URLスキーム

先頭の"https"の部分は「URLスキーム」(URL Scheme)と呼ばれ、このURLの種類を表します。スキームの一覧はIANAの[Uniform Resource Identifier (URI) Schemes](https://www.iana.org/assignments/uri-schemes/uri-schemes.xhtml)で確認することができます。httpsの他に、よく使われるのは以下のようなものです。

- http
- ftp
- file
- wss
- mailto

スキームは多くの場合、リソースの取得方法となるプロトコルを表しています。ただし、常にスキームが通信プロトコルを表すとは限りません。たとえば"mailto:"で実際に使われるのはSMTPですし、"file:"にいたっては通信が発生しません。また、IANAには登録されていませんが、"javascript"というスキームのURLが使われることもあり、こちらも通信は発生しません。

スキーム名のあとは ":" 一文字で区切ります。その後に続く内容はスキームによって異なりますが、ここではhttpやhttpsの場合を紹介します。

### ホスト

httpやhttpsの場合、 "//" に続いて「ホスト」(host)が書かれます。ホストは、ドメイン名、IPv4アドレス、IPv6アドレスのいずれかです。多くの場合はドメイン名が使用されます。ドメイン名はFQDN(Fully Qualified Domain Name, 完全修飾ドメイン名)でなくても構いません。また、以下のように"localhost"を指定してローカルを参照する形もよく使われます。

```text
http://localhost
```

#### ポート

ホストの後ろには「ポート」(port)の情報が来ることがあります。ポートを書く場合は ":" で区切って、0〜65535のいずれかのポート番号を記述します。

```text
http://localhost:8080
```

ポートの記述は省略することもできます。省略するとデフォルトのポートが使用されます。httpなら"80"、httpsなら"443"です。その他のポート番号の一覧はIANAの[Service Name and Transport Protocol Port Number Registry](https://www.iana.org/assignments/service-names-port-numbers/service-names-port-numbers.xhtml)で見ることができます。

### パス

ポート番号のうしろ (ボートが省略されている場合はホストのうしろ) には、「パス」(path)の記述が続きます。パスは、そのホスト内でリソースを特定するための記述です。

パスは "/" で始まります。さらに複数の "/" で区切って階層化することもできます。たとえば以下のようになります。

```text
http://localhost/foo/bar/baz.html
```

"/"で区切られたそれぞれの部分を「URLパスセグメント」(URL path segment)と呼びます。上記の例では"foo"と"bar"と"baz.html"がURLパスセグメントにあたります。

特殊なURLパスセグメントとして、`.`と`..`があります。`.` は現在と同じ階層、`..` は親階層を表します。

`.`は現在の階層を表しますので、`.`が出現する前のパスを指すことになります。つまり、以下はすべて同じリソースを指します。

```text
/foo/
/foo/./
/foo/./././././././
```

`.`が間に挟まっても同じです。以下は全て同じリソースを指します。

```text
/foo/bar/
/foo/./bar/
/foo/./././bar/././././
```

`..`の場合は親階層を指します。以下は全て同じリソースを指します。

```text
/foo/
/foo/bar/../
/bar/../foo/
/bar/../baz/../foo/
```

こう見ると冗長なだけのように見えますが、この記述方法は後述する「パス相対URL」で活躍します。

### クエリ

パスの後ろには、「クエリ」(query) と呼ばれる文字列がつくことがあります。クエリをつける場合は、"?" 一文字で区切ります。

クエリというのは「問い合わせ」というような意味です。GETメソッドフォームを送信すると、フォームに入力したデータがURLの末尾につけられ、URLを通じてサーバに送信されます。これがクエリです。つまり、サーバに対する問い合わせに使用するところからこの名前が来ています。現在では、クエリはフォーム送信の時だけでなく、アクセス元をトラッキングする目的や、キャッシュを更新させる目的で使用されることもあります。

### フラグメント

URLの末尾には、「フラグメント」(fragment)と呼ばれる文字列がつくことがあります。フラグメントをつける場合は、"#" 一文字で区切ります。
フラグメントとは「断片」という意味です。URLは特定のリソースを指しますが、そのリソースの中のある特定の部分を指したい時にフラグメントを使用します。HTMLの場合は、`id`属性
で指定された名前をそのままフラグメントとして指定することで、HTML文書の特定の箇所を指すことができます。

フラグメントは「ハッシュ」(hash)と呼ばれることもあります。区切りに使用する "#" という文字 (U+023, "NUMBER SIGN") は、別名としてハッシュとも呼ばれるためです。たとえば、JavaScriptでは`location.hash`でフラグメントの値を参照することができます。

## 相対URL

URLと言えば、前述したように、スキームから始まる形式を連想することが多いと思います。このように、スキームから始まる完全な形式のURLを「絶対URL」(absolute URL)と呼びます。

それに対して、「相対URL」(relative URL)と呼ばれるURLの表記方法もあります。相対URLでは、現在の場所からの相対位置を示します。HTML文書を閲覧している場合は、そのHTML文書自体のURLか、`base`要素で明示的に指定されたURLを「基準URL」(base URL)として、そこからの相対参照と解釈します。

相対URLは以下のようなものがあります。

- 「スキーム相対URL」(scheme relative URL)
- 「パス絶対URL」(path absolute URL)
- 「パス相対URL」(path relative URL)

### スキーム相対URL

スキーム相対URLは、絶対URLからURLスキーム名と":"を取り除いたものです。先頭が "//" で始まり、ホスト名が続きます。以下のような形になります。

```text
//example.com/foo/bar.html
```

スキーム相対URLを使用した場合、スキームは基準URLと同じものとみなされます。たとえば、上記は、基準URLのスキームがhttpsならば `https://example.com/foo/bar.html` に、httpならば `http://example.com/foo/bar.html` と同じになります。

### パス絶対URL

パス絶対URLは、スキーム相対URLからホスト名部分を取り除いたものです。先頭が "/" で始まり、パスの記述が続きます。

```text
/foo/bar.html
```

パス絶対URLを使用した場合、スキームとホスト名は基準URLと同じものとみなされます。

名前に「絶対」とありますが、これはURL全体が絶対という意味ではなく、パス部分が絶対パスで書かれているという意味です。パス絶対URLは絶対URLではなく、相対URLの一種です。

### パス相対URL

パス相対URLは、先頭が "/" で始まらないパスの記述です。

```text
foo/bar.html
```

パス相対URLを使用した場合、スキームとホスト名は基準URLと同じとみなされ、基準URLからの相対パスとして解釈します。

パス相対URLでは、URLパスセグメントに`.`や`..`を使う記述が生きてきます。たとえば、基本URLのパスが`/foo/bar/baz.html`だったとき、以下のようになります。

- `./` → `/foo/bar/`
- `../` → `/foo/`
- `../../` → `/`
- `./baz2.html` → `/foo/bar/baz2.html`
- `../baz2.html` → `/foo/baz2.html`

## URLに使える文字

URLパスセグメントやクエリ、フラグメントに使える文字は決まっています。

- ASCII文字の英数字
- 記号類: `!`, `$`, `&`, `'`, `(`, `)`, `*` , `+`, `,`, `-`, `.` `/`, `:`, `;`, `=`, `?`, `@`, `_`, `~`
- U+00A0 〜 U+10FFFD までのUnicode文字。ただし、サロゲート文字(surrogates)と非文字(noncharacters)を除く

カッコ`(`, `)`がURLにそのまま使える文字であることに注意してください。メール等で文中のURLがリンクになるような仕組みがありますが、`(https://example.com)` と書くと、末尾の `)` がURLの一部とみなされることがあります。`<`や`>`はURLにそのまま使用できないので、URLを囲みたい場合はこちらを使うと誤認識を防げます。

URLに使用できない文字や、特別な意味に解釈される文字は、「パーセントエンコードバイト」(Percent-encoded bytes)として記述することができます。この記述方法は「パーセントエンコード」「URLエンコード」と呼ばれることもあります。

パーセントエンコードバイトの記述は、"%" に続いて2桁の十六進数で文字コードを表記します。たとえば、"<"は"%3C"、">"は"%3E"となります。

パーセントエンコードではない目的で"%"という文字そのものを書きたい場合は、"%25"と

非ASCII文字をパーセントエンコードする際には、原則としてUTF-8で符号化して扱います。たとえば、「日本語」という文字列の場合、UTF-8で符号化すると以下のようになります。

-「日」(U+65E5) → E6 97 A5
-「本」(U+672C) → E6 9C AC
-「語」(U+8A9E) → E8 AA 9E

これをパーセントエンコードすると以下のようになります。

```text
%E6%97%A5%E6%9C%AC%E8%AA%9E
```

## パスワード付きURL

URLのホスト部の前に認証情報がつく形式が存在します。IDとパスワードを":"でつなぎ、後ろを"@"で区切って、そのあとにホストを続けます。以下のような形になります。

```text
https://user:password@example.com/
```

URLに認証情報を含めることはセキュリティ上の問題に繋がりやすいため、このようなURLは現在の仕様では認められていません。しかし、ブラウザは互換性の理由から、このような形式のURLを受け入れて解釈する場合があります。

プログラムでURLをチェックする場合には、ホストの前に認証情報がつくこともあるということを念頭に置いておきましょう。

## コラム: URLという言葉の歴史

URLという言葉は多くの方に馴染みがあると思いますが、実はこの言葉は混乱を乗り越えてきた歴史があります。

初期のHTMLで使われていた「URL」は "Uniform Resource Locator" と呼ばれるものでした。その後、リソースを名前で特定する「URN」(Uniform Resource Name)という方式が追加され、それらをあわせて「URI」(Uniform Resource Identifier)と呼ぶようになりました。HTML4の仕様では「URI」という表記が使われています。さらにその後、URIの国際化表記である「IRI」(Internationalized Resource Identifier)が現れました。

こうして、「URL」「URI」「IRI」という3種類の表記が生まれました。「URL」は「URI」の一種であり、「URI」は「IRI」の一種です。ですので、「URL」という言葉が使える文脈では、3つのどれを使っても意味が通じます。こうなると逆に使い分けが難しくなってきます。そして世間では「URI」「IRI」はそこまで知られておらず、依然として「URL」という言葉が使われ続けていたのです。

この状況をふまえ、HTML5ではこれらをあらためて「URL」という名前で統合することにしました。ここで言うURLは、Uniform Resource LocatorであるURLと同じものではなく、URIやIRIを再統合したものとなっています。

つまり、URL→URI→IRIと変遷した上で、もう一度「URL」に戻ってきたのです。
こういった事情で成立しているため、現在のURLは"Uniform Resource Locator"の略というわけではなく、何の略であるのかは特に定義されていません。
