# WAI-ARIAの実践と活用
<!-- class="hidden" のかわりに aria-hiden="true" を使ったらどうかという話。4ページも書くことがあるのかは謎。-->

この節では、WAI-ARIAの実践について、いくつかの具体例を通してみていきます。

## WAI-ARIAの実践

4-2節ではWAI-ARIAの基礎的な知識について見ていきましたが、この節では具体的な実践例についてみていきたいと思います。

そうは言っても、紙面の都合上、取り上げることのできる例については限られます。

この節では、WAI-ARIA仕様の関連文書であるWAI-ARIA Authoring Practices[^1]をもとにして、いくつかの例をとりあげます。ここでは取り上げない例については、Authoring Practicesを参照ください。

[^1]: https://www.w3.org/TR/wai-aria-practices/


### ハンバーガーメニュー

モバイル用のページでは、ウェブ制作者にとってはすっかりとおなじみになったパーツですが、基本方針としては、メニューが展開しているのか、折りたたまれているのかをユーザーに伝える必要があります。

なお、折りたたみのあるアコーディオンについても考え方は同じになります。

```
三    ×
開く 閉じる
```

図5-6-0x ハンバーガーメニューのアイコン画像の例。左が折りたたまれている状態、右が展開している状態。

アイコン画像が画像で提供される場合に、対応するマークアップ例は次のようになります。

```html
<button type="button" aria-controls="hamburger-menu" aria-expanded="false">
  <img src="open.png" alt="開く"><!-- ハンバーガーメニューのアイコン -->
</button>
<div id="hamburger-menu">
  <!-- メニューの内容 -->
</div>
```

`aria-controls`属性は、属性を指定した要素が制御する要素を特定するものです。制御する要素は、`id`属性で紐付けます。この例ではメニューの内容が記述されている`div`要素に紐付けています。

`aria-expanded`属性は、制御する対象が展開されているのか、それとも折りたたまれているのかどうか、その状態を示す属性です。


#### アクセシビリティ上の留意点 <!-- 後ろでまとめるべきか -->

ハンバーガーメニューに限らず、独自UIすべてに言えることですが、マウスだけでなくキーボードでも操作できるようにする必要があります。これはウェブアクセシビリティ上の要請[^2]であり、ウェブサイトが最低限備える必要のある機能です。

また、<kbd>Tab</kbd>キーを用いてキーボード操作をするとありがちですが、展開したメニューの背後に隠れていて見えない状態にある、本文のリンク等にキーボードフォーカスが当たってしまうという実装がよく見られます。ウェブアクセシビリティの観点からは、フォーカスの順序[^3]の問題になります。展開したメニューの中でキーボードフォーカスをループさせたり、メニュー末尾からフォーカスを移動するときにメニューを自動的に閉じるなどして、キーボードユーザーが使えるページにする必要があります。

[^2]: WCAG 2.1 Success Criterion 2.1.1 Keyboard https://www.w3.org/TR/WCAG21/#keyboard

[^3]: WCAG 2.1 Success Criterion 2.4.3 Focus Order https://www.w3.org/TR/WCAG21/#focus-order

### カルーセル

```
--+ +---+ +--
1 | | 2 | | 3
--+ +---+ +--

```
1と3のスライドを隠すイメージ



### タブパネル

タブメニューとも呼ばれる、サイトのトップページなどで見かけることのある、タブ切り替え機能です。典型的には、タブの一覧になっているタブリストがパーツ一式の上側にあり、下側にタブに関連付けられたタブパネルがあります。

<!-- 

イメージはここから適当に持ってくればよいか

デザインの参考に！おしゃれなタブメニューを導入しているサイトまとめ
https://www.hiroseyonaka.com/entry/2017/04/06/120610 

-->

ここにタブパネルのイメージ

図5-6-0x タブパネルの例。


```html
<div class="tabs">
  <div role="tablist">
    <button role="tab" aria-selected="true" aria-controls="topics-tab" id="topics">
      トピック
    </button>
    <button role="tab" aria-selected="false" aria-controls="release-tab" id="release" tabindex="-1">
      プレスリリース
    </button>
  </div>
  <div tabindex="0" role="tabpanel" id="topics-tab" aria-labelledby="topics">
    <ul>
      <li>広報紙最新号を発行しました。</li>
    </ul>
  </div>
  <div tabindex="0" role="tabpanel" id="release-tab" aria-labelledby="release" hidden>
    <ul>
        <li>○○報告会を開催します。</li>
    </ul>
  </div>
</div>
```

タブに`tab`ロールを付与し、複数のタブを`tablist`ロールを持つ要素でグループ化します。選択しているアクティブなタブは`aria-selected="true"`とし、選択していないタブについては属性値`false`を与えます。

アクティブでないタブに`tabindex="-1"`を与え、各タブパネルに`tabindex="0"`を与えることで、<kbd>Tab</kbd>キーでの移動はアクティブなタブから関連付けられたタブパネル間となります。これにより、タブ間の移動は左右の矢印キーを用いることになります。

タブとタブパネルの関連付けは`aria-controls`属性と`id`属性を用いています。また、`aria-labelledby`でタブパネルに対する名前を提供します。アクティブでないタブパネルについては`hidden`属性で非表示にしています。


### モーダルダイアログ

モーダルダイアログは、メインコンテンツの上に重ねられて表示されるダイアログです。ダイアログが表示されている間、言い換えるとダイアログを閉じるまで、メインコンテンツは無効になります。

<!--
https://www.w3.org/TR/wai-aria-practices/#dialog_modal
https://www.w3.org/TR/wai-aria-practices/examples/dialog-modal/dialog.html
https://qiita.com/ishimasar/items/47f29b958946a2c53e93
-->

図5-xx-x モーダルダイアログのイメージ図

<!--
### フォームのライブリージョン

「ライブリージョン」（live region）は、ページ全体をリロードすることなく、ページの一部を更新したときに、その更新された領域を支援技術に通知するためのものです。

使用方法としてはいくつかのシーンが考えられますが、ここではフォームのエラーメッセージを考えてみます。

https://www.w3.org/TR/wai-aria-practices-1.1/examples/alert/alert.html

「検索結果の絞り込み」
-->


### 失敗例：ライブリージョンを誤って指定している

支援技術に対して更新内容を伝えることのできるライブリージョンですが、誤って使用されている例も見られます。

誤って使用されている例の1つとしては、自動再生されるカルーセルにライブリージョンを設定している場合です。

カルーセルに対して設定することで、スライドが切り替わるたびに更新内容が支援技術に通知されることになります。

そのために、音声読み上げではスライドが切り替わるたびに更新内容が読まれてしまいます。スライドの切り替わりが一定以上の間隔であれば、常にカルーセルの更新内容が読まれ続けることになり、カルーセルの更新通知以外のページの内容を理解することが困難になります。

このように、aria-live


### 画像をインラインSVGで表す

HTMLに直接インラインでSVGを記述したい、という場面も珍しくないでしょう。その場合、WAI-ARIAを付与する必要が出てきます。

`svg`要素はSVG 2仕様によれば`graphics-document`というロールを持っていることになります[^3]。通常の画像として扱いたい場合は、`img`ロールを付与します。

[^3]: https://www.w3.org/TR/SVG2/struct.html#implicit-aria-semantics 端的に言えば、文書である`document`ロールの性質も持っているということです。

意味のある画像については、代替テキストを（SVGの）`title`要素で与えます。

```html
<svg role="img">
  <title>代替テキスト</title>
  ...
</svg>
```

`aria-describedby`で明示的に`svg`要素と`title`要素を結びつける方法がありますが、仕様上[^4]はそのようにする必要はありません。

[^4] https://www.w3.org/TR/svg-aam-1.0/#mapping_additional

```html
<!-- 冗長な例 -->
<svg role="img" aria-describedby="svgdesc">
  <title id="svgdesc">代替テキスト</title>
  ...
</svg>
```

画像が意味を持たない純粋に装飾的な画像である場合は、支援技術に無視させればよく、`aria-hidden`属性を用います。この場合、支援技術に何も伝えないため、`role`属性を指定する必要はありません。

```html
<svg aria-hidden="true">
  <!-- 純粋に装飾的な画像 -->
  ...
</svg>
```

#### 画像にありがちなアクセシビリティの問題

画像を`img`要素で表す場合は、代替テキストについては単に`alt`を考えるだけでよいのですが、前述のインラインSVGのように`img`要素でない方法で画像を表す場合、代替テキストを用意することを考える必要があります。

`alt`による代替テキストは、何らかの原因で画像が読み込めなかったときに、ブラウザー上で画像の代わりに表示されるという特性があります。代替テキストを提供する場合は、この特性と同等の挙動を実現する必要があります。

<!-- 4-3に移動すべきか？ -->

例えば、font awesomeのようなフォントアイコンで、`aria-label`属性で代替テキストの代わりにする実装を見かけることがありますが、`aria-label`はラベルであって代替テキストではありません。画面上に見えないラベルであるため、`alt`と同じ挙動にはなりません。

```html
<!-- 好ましくない実装例 -->
<i class="..." aria-label="開く"></i>
```

このような手法は既存サイトの緊急避難的な改修の場合に留め、新規にサイトを構築する際は避けることが望ましいです。