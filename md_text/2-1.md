<!--
知識編 2章 HTMLマークアップのルール
2-1. 開始タグと終了タグ
4p
-->

# 2-1. HTMLの要素とタグの基本

1章では、HTMLがマークアップ言語であることを説明しました。ここでは、HTMLの基本的な構文について説明していきます。

## 要素とタグ

マークアップとは、テキストにマークをつけて意味や構造を明確にすることです。HTMLは、テキストデータと、それに対するマークから成り立っています。

1章では以下のようなテキストの例を示しました。

```text
これは見出しのテキストのかたまりです
これは本文です。このキーワードはこの文章で重要なものを表します。
```

このテキストには、見出し、本文、そしてキーワードが含まれています。別の言い方をすれば、「見出し」「本文」「キーワード」という一連の意味を持ったまとまりが存在することになります。1章で触れたように、HTMLでは、こういったまとまりを「要素」(element)と呼んでいます。

マークアップ言語の役割は、要素を明示することです。要素を明示するには、以下の2つの情報が必要になります。

- それがどんな要素なのか
- どこからどこまでがその要素になるのか

HTMLでは、この情報を「タグ」(tag)と呼ばれるマークを使って表現します。先ほどの例にHTMLのタグを付け加えると、以下のようになります。

```html
<h1>これは見出しのテキストのかたまりです</h1>
<p>これは本文です。</p>
<p>この<mark>キーワード</mark>はこの文章で重要なものを表します。</p>
```

`<`と`>`で囲まれた部分がHTMLのタグです。最初の行は見出しですが、見出しの先頭に`<h1>`を、末尾に`</h1>`を入れています。このように、要素の開始位置と終了位置にタグを入れることで、要素の種類とその範囲を明らかにします。

### 開始タグと終了タグ

要素の開始位置を表現するタグを「開始タグ」(start tag)と呼びます。開始タグは`<`で始まり、`>`で閉じられます。"h1"と書かれている部分は「タグ名」(tag name)と呼ばれ、要素の名前である「要素名」(element name)を表現しています。

要素の終了位置を表現するタグを「終了タグ」(end tag)と呼びます。終了タグは、`</`で始まります。タグ名が書かれる点、`>`で閉じられる点は開始タグと同様です。

また、タグを除いた要素の中身の部分を、要素の「内容」(content)と呼びます。

もう一度、さきほどのマークアップを見てみましょう。

```html
<h1>これは見出しのテキストのかたまりです</h1>
<p>これは本文です。</p>
<p>この<mark>キーワード</mark>はこの文章で重要なものを表します。</p>
```

1行目には、`<h1>`という開始タグと、`</h1>`という終了タグがあります。この部分全体が`h1`という要素名の要素となります。この`h1`要素の内容は、「これは見出しのテキストのかたまりです」というテキストです。

2行目は開始タグ`<p>`と終了タグ`</p>`でマークアップされ、`p`要素であることを表現しています。要素の内容は「これは本文です。」というテキストです。

3行目は少し複雑です。2行目と同じように`p`要素としてマークアップされているのですが、要素の内容は単純なテキストではありません。この要素の中にはさらに`<mark>`と`</mark>`というタグがあります。

`p`要素の内容には、テキストだけでなく、`mark`要素が入っている形になります。

### 要素の入れ子

このように、ある要素の内部に別の要素が入っていることを「入れ子」(nest)と言います。ある要素の内部に別の要素を入れることを、「入れ子にする」、あるいは「ネストする」と言います。

入れ子は多重にすることもできます。以下の例では、`body`要素の中に`p`要素が入れ子になり、その中にさらに`mark`要素が入れ子になっています。

```html
<body>
<p>この<mark>キーワード</mark>はこの文章で重要なものを表します。</p>
</body>
```

ある要素の中に入っている要素のことを、その要素の「子孫」(descendant)と言います。また、ある要素の直下にある要素を「子」(child, children)と言います。

逆に、ある要素のすぐ外側の要素を「親」(parenmt)、親の親なども含む外側の要素全般を「祖先」(ancestor)と言います。

上記の例では、`mark`要素は、`p`要素の子要素であり、子孫要素です。`mark`要素は、`body`要素の子要素ではありませんが、`body`要素の子孫要素です。

なお、ある要素の子要素になれる要素は決まっています。たとえば、`p`要素の中に`mark`要素を入れることはできますが、`mark`要素の中に`p`要素を入れることはできません。詳しくは2-7「要素の入れ子と内容モデル」の節で説明します。

#### 子要素が親要素の外にはみ出すことはない

子要素が親要素の範囲からはみ出すことはありません。たとえば、以下のようにマークアップしたとします。

```html
<p>ある<mark>長いキーワード</p>
<p>キーワードの続き</mark>はこの文章で重要なものを表します。</p>
```

このように、子要素が親要素からはみ出したり、複数の要素にまたがることはできません。このようなマークアップは不正なものとして、エラーになります。実際には、ブラウザはこのようなエラーに出会うと、マークアップを以下のように修正して解釈します。

```html
<p>ある<mark>長いキーワード</mark></p>
<p>キーワードの続きはこの文章で重要なものを表します。</p>
```

この修正のされ方は要素によって異なります。上記の例で`mark`要素のかわりに`b`要素を使った場合、修正のされ方が異なり、以下のように補われます。

```html
<p>ある<b>長いキーワード</b></p>
<p><b>キーワードの続き</b>はこの文章で重要なものを表します。</p>
```

なお、これはあくまでマークアップの構造上の話です。要素をブラウザ上でレンダリングした際の見た目の話であれば、子要素を親要素からはみ出させたり、親要素の外に出したりすることはできます。

### 終了タグの省略

先ほどの例は不正なマークアップで、そのエラーを回復するために、タグを補って解釈する処理が行われていました。時にはエラーではなく、正当なルールに沿ってタグが補われることもあります。別の言い方をすれば、タグを省略してもよい場合があるということです。

省略の可否は要素によって異なります。何度か出てきた`p`要素は、終了タグが省略できる場合があります。先の例は以下のように書くこともできます。

```html
<p>ある<mark>長いキーワード</mark>
<p><mark>キーワードの続き</mark>はこの文章で重要なものを表します。
```

`</p>`が書かれていませんが、これはエラーにはならず、以下のように補われて解釈されます。

```html
<p>ある<mark>長いキーワード</mark></p>
<p><mark>キーワードの続き</mark>はこの文章で重要なものを表します。</p>
```

ある要素の終了タグが省略できるかどうか、どのような場合に省略できるかは、仕様書の各要素の説明に書かれています。たとえば、`mark`要素の場合は、「[4.5.23 mark要素](https://momdo.github.io/html/text-level-semantics.html#the-mark-element)」に以下のように書かれています。

>text/htmlにおけるタグ省略：
>どちらのタグも省略不可。

これは、開始タグも終了タグも省略できないという意味です。一方、`p`要素の場合は、「[4.4.1 p要素](https://momdo.github.io/html/grouping-content.html#the-p-element)」に以下のような記述があります。

>text/htmlにおけるタグ省略：
>p要素がaddress、article、aside、blockquote、details、div、dl、fieldset、figcaption、figure、footer、form、h1、h2、h3、h4、h5、h6、header、hgroup、hr、main、menu、nav、ol、p、pre、section、table、ul要素の直後に存在する場合、または親要素で追加のコンテンツが存在せずかつ親要素がa、audio、del、ins、map、noscript、video要素、または自律カスタム要素でないHTML要素である場合、p要素の終了タグは省略することができる。

こちらは一定の場合に終了タグを省略できることがわかります。他には、`li`要素、`dt`要素、`dd`要素、`tr`要素、`th`要素、`td`要素、`caption`要素、`thead`要素、`tbody`要素、`tfoot`要素、`option`要素、`rp`要素、`rt`要素などの終了タグが省略可能とされています。

### 開始タグの省略

また、要素によっては、開始タグも省略できる場合があります。具体的には、`html`要素、`head`要素、`body`要素、`tbody`要素が該当します。以下はタグを省略して書いた例です。

```html
<!DOCTYPE html>
<title>test</title>
<table>
<tr><th>見出し1<td>データ1
<tr><th>見出し2<td>データ2
</table>
```

`html`要素、`head`要素、`body`要素、`tbody`要素の開始タグが書かれていません。しかしこのマークアップはエラーではなく、以下のように解釈されます。

```html
<!DOCTYPE html>
<html>
<head>
    <title>test</title>
</head>
<body>
<table>
    <tbody>
        <tr>
            <th>見出し1</th>
            <td>データ1</td>
        </tr>
        <tr>
            <th>見出し2</th>
            <td>データ2</td>
        </tr>
    </tbody>
</table>
</body>
</html>
```

このように、タグを全く書かなくても要素が存在する場合があります。とはいえ、HTMLのソースコードを読んだ際に分かりにくく、挙動が予想しにくくなることがあるため、開始タグの省略はしないことが多いです。

### 終了タグを持たない要素

タグの省略について説明しましたが、そもそも終了タグを持たない要素もあります。HTMLの要素の多くは、テキストか、もしくは子要素を含んでいますが、中には内容を全く含まない要素もあります。

たとえば、`br`要素は改行を指定する要素で、その位置で改行されることが期待されます。以下は、`br`要素を使った例です。

```html
<p>詩などの<br>文章では<br>改行位置が<br>重要になることもあります。</p>
```

`br`要素はその性質上、その中にテキストや他の要素を含むことはありません。このように、決して内容を持つことのない要素を「空要素」(void element)と呼びます。

空要素には終了タグを書くことができません。書いても書かなくても良いのではなく、書いてはいけないことになっています。以下は正しくない例です。

```html
<p>詩などの<br></br>文章では<br></br>改行位置が<br></br>重要になることもあります。</p>
```

このように書いた場合、`</br>`は不正なマークアップとしてエラーになります。そしてエラー処理の結果、そこに`<br>`が書かれているものとして扱われます。つまり、`<br></br>`と書くと`<br>`をふたつ書いた場合と同じ動作になります。

なお、どの要素が空要素なのかは決まっています。空要素ではない要素について、内容がたまたま空になるようなケースがありますが、その場合は終了タグを書く必要があります。詳しくは2-7「要素の入れ子と内容モデル」で説明します。

## HTML文書とDOCTYPE

HTMLを扱う際は、一つの文書に含まれるテキスト全てをマークアップして扱うことが一般的です。このように、文書全体をHTMLとしてマークアップしたものを「HTML文書」(HTML document) と呼びます。

HTMLを文書全体としてではなく、一部分だけ切り出して扱うこともあります。たとえば、HTMLの部品を他の文書に埋め込むような想定のとき、部品の側はHTML文書全体ではなく、一部だけを含むものになります。このように切り出した一部分は、「HTML断片」(HTML fragment) と呼びます。

ここまで、タグを使って要素をマークアップする方法を説明してきましたが、HTML文書を完成させるためにはまだ必要なものがあります。

HTML文書の冒頭には、以下のようなマークを書く必要があります。これを「DOCTYPE」と呼びます。

```html
<!DOCTYPE html>
```

大文字・小文字は区別しないことになっていますので、小文字で書かれることもあります。

```html
<!doctype html>
```

DOCTYPEは、この文書がHTML5で書かれているということを識別するためのものです。DOCTYPEが存在しない場合、HTML5ではない可能性が高いと判断され、「奇癖モード」(quirks mode) で処理されることになります。

### DOCTYPEの互換性と文書型宣言

DOCTYPEは「文書型宣言」(Document type declaration)と呼ばれることもあります。文書型宣言はSGMLにあった概念です。かつてのHTMLはSGMLのルールに従っていたため、文書型宣言が必須でした。HTML5はSGMLではなくなり、文書型宣言も不要となったのですが、ブラウザの互換性のために、文書型宣言と似た形の「DOCTYPE」を書くことになっています。

現在のDOCTYPEの記述は、SGMLの文書型宣言として正当な形にはなっていません。SGMLやXMLを出力するプログラム (XSLTプロセッサなど) でHTMLを生成しようとする際、文書型宣言を省略したり変形したりできないこともあります。そのような場合のために、以下のような記述も許されています。

```html
<!DOCTYPE html ststem "about:legacy-compat">
```

これは冗長ですが、SGMLの文書型宣言としても適正な形になっています。通常はこちらを使う必要はありませんが、プログラムの都合で通常のDOCTYPEが出力できない場合、こちらを利用しても構いません。

## 最低限のHTML文書

さて、ここまでの説明で、ひとまず、HTML文書を作成する準備が整いました。以下はHTML文書のサンプルです。

```html
<!DOCTYPE html>
<html>
<head>
<title>最低限のHTML</title>
</head>
<body>
<h1>最低限のHTML</h1>
<p>これはHTML文書です!</p>
</body>
</html>
```
