# 要素の入れ子と内容モデル

要素を入れ子にできることを説明しました。しかし、どの要素をどこに入れても良いわけではなく、ルールが決まっています。ここではそのルールの概要と、確認の仕方を説明します。

## 要素の入れ子ルール

要素を入れ子にできることはすでに説明しました。以下のマークアップでは、`p`要素の中に`mark`要素が入れ子になっています。

```html
<p>この<mark>キーワード</mark>はこの文章で重要なものを表します。</p>
```

この入れ子関係を逆にすることはできません。仕様では、`mark`要素の内容に`p`要素を入れられないことになっています。従って以下のようなマークアップは不正です。

```html
<mark>この<p>キーワード</p>はこの文章で重要なものを表します。</mark>
```

とはいえ、特にエラーを補正する処理などは行われずに、DOMツリーにはこのまま追加されます。

## 内容モデル

要素の中身にあたる部分を、要素の「内容」(content)と呼ぶことはすでに説明しました。要素によって、内容に何を含められるかが決まっています。この、要素の内容についての決まりのことを「内容モデル」(Content model) と呼びます。仕様の各要素の項目には内容モデルの記述があります。

たとえば、`ol`要素の内容モデルは以下のようになっています。

>Zero or more li and script-supporting elements.

ひとつ以上のli要素を含むことになっています。なお、"script-supporting elements" とは`script`要素と`template`要素を指し、これらはほぼどこにでも書くことができます。

他の要素を子要素にできない要素も存在します。`title`要素の内容モデルは以下のようになっています。

>Text that is not inter-element whitespace.

端的に言えば、テキストしか入れられないということになります。なお、"inter-element whitespace"とは要素間の空白類文字列のことで、ここでは`<title>`タグ直後と`</title>`タグ直前の改行やスペースを指します。

要素によっては、もっと複雑な定義になっていることもあります。`table`要素の内容モデルは以下のようになっています。

>In this order: optionally a caption element, followed by zero or more colgroup elements, followed optionally by a thead element, followed by either zero or more tbody elements or one or more tr elements, followed optionally by a tfoot element, optionally intermixed with one or more script-supporting elements.

しかしこれらは例外的な規定です。多くの要素はもっとシンプルな内容モデルの定義になっています。[p要素](https://html.spec.whatwg.org/multipage/grouping-content.html#the-p-element)や[mark要素](https://html.spec.whatwg.org/multipage/text-level-semantics.html#the-mark-element)を見ると、内容モデルは以下のようになっています。

>Content model:
> Phrasing content.

"Phrasing content" は要素の「カテゴリ」(categories) のひとつで、`a`, `em`, `img`, `span`, `mark` などが含まれています。HTML4をご存知の方は、「インライン要素」の名前が変わったものだと理解していただければ近いでしょう。

先に挙げた例では、`p`に`mark`を入れることはできるが、逆はできないと紹介しました。内容モデルを見ると、`p`要素も`mark`要素も内容モデルは"Phrasing content"です。`mark`は"Phrasing content"ですから、`p`は`mark`を子にすることができます。いっぽう、`p`要素は"Phrasing content"ではありませんから、`mark`は`p`を子にすることができません。

### 要素のカテゴリ

ほとんどの要素は、内容モデルを要素のカテゴリで指定しています。要素のカテゴリは仕様の[3.2.5.2 Kinds of content](https://html.spec.whatwg.org/multipage/dom.html#kinds-of-content)で規定されており、以下のようなものがあります。

- Metadata content
- Flow content
- Sectioning content
- Heading content
- Phrasing content
- Embedded content
- Interactive content

カテゴリと要素は一対一対応するわけではなく、ある要素が複数のカテゴリに属することもあります。また、上記のカテゴリに属していない要素もあります。

このうち、内容モデルの定義で主に使用されるのは、Metadata, Flow, Phrasing です。

#### Metadata

HTML文書のメタデータを扱う要素が属するグループです。原則としてhead要素内で使用され、画面上に表示されることはないものです。`link`要素、`meta`要素、`title`要素などが含まれます。

#### Flow

HTML文書のコンテンツとして使われる要素群が属するグループです。flowは非常に大きな括りで、後述するカテゴリ全てを含みます。コンテンツとして表示される要素のほとんどがここに含まれます。

内容モデルが flow とされている場合、「何でも入れてよい」という意味だと捉えても大きな間違いはありません。ただし、前述のメタデータコンテンツや、`tr`や`li`など、特定の要素を親に持つ必要があるものは含まれません。

flowは「流れ」という意味ですが、ここでは「本文として流し込まれるもの」というようなイメージです。CSSをご存知の方は、CSSのNormal Flowでレイアウトすることができる要素、と捉えるとイメージしやすいでしょう。

HTML4をご存知の方は、ブロック要素とインライン要素を合わせたものだと考えていただけばよいと思います。

#### Phrasing

Flowに含まれる要素のうち、特にパラグラフ内部で使用されるようなマークアップ要素です。`a`, `em`, `img`, `span`, `mark`などが入ります。

HTML4をご存知の方であれば、「インライン要素」と呼ばれていたものだという説明でわかるでしょう。

### コラム: ブロックとインラインはどこへ?

HTML4では要素が大きく「ブロックレベル要素」「インライン要素」に分類されていました。この分類はわかりやすい面もありましたが、意味ではなく見た目に由来する命名になってしまっていました。

「インライン要素」は基本的にインライン表示されますが、これはブラウザのデフォルトスタイルで`display: inline`が指定されているからににすぎません。コンテンツ製作者が明示的に`display:block`を指定すれば表示を着替えることも可能で、分類の名前と実際の表示が食い違うこともありました。

HTML5では「インライン要素」「ブロックレベル要素」という分類を廃止し、前者をPhrasing、両者を合わせたものをFlowとしました。HTML4でいう「ブロックレベル要素」に対応するグルーピングは、HTML5にはありません。ブロックレベル要素に相当する要素を指し示したい機会はしばしばあるので不便に感じますが、「ブロック要素である」という言い方を「Phrasing要素ではない」と言い換えるなどして工夫するしかありません。

### transparent


### Nothing

要素の中には、内容モデルが"Nothing"とされているものがあります。これは、その要素が「空要素」(void element)であることを意味します。
空要素の中には何も入れられませんし、終了タグを書くこともできません。

#### コラム: 空要素のvoidとempty

「空要素」と呼ばれる要素の定義はHTML4にもありましたが、HTML4では、"empty element" と呼ばれていました。これは、内容モデルが"EMPTY"の要素、の意味です。HTML4はSGML応用系であるため、DTDでたとえば以下のように要素を定義していました。

```DTD
<!ELEMENT BR - O EMPTY -- forced line break -->
```

HTML5はSGMLではなくなり、DTDもなくなりましたが、空要素という概念は残りました。しかし、実は呼び名が"empty element"ではなく"void element"に変わっています。日本語ではどちらも「空要素」とされるので、日本語訳だけ読んでいると、名前が変わったことに気づかないかもしれません。

ここからは筆者の想像ですが、英語圏では「空の要素」とややこしかったのではないでしょうか。空要素でない要素の内容がたまたま空になることはあります (`<span></span>`のように)。この時、日本語では「空の要素」と言えば混乱しませんが、英語で表現するとempty elementとなってしまい、空要素と紛らわしいことになります。これはややこしいので、空要素をvoidとして区別できるようにしたのかもしれません。


## 内容モデルの逆引き

仕様では逆引きもできるように、"Contexts in which this element can be used" という記述もあります。ただし、こちらは標準ではなく参考情報であり、あくまで利便性のために書かれているものです。仕様としての正確な情報を知りたい場合は、内容モデルの方を確認するようにしてください。











### HTML4との違い


