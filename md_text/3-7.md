<!-- ch3-7.txt (4ページ、3000～4600字想定) -->
# エンベティッドコンテンツ

この節では、画像や音声、映像を埋め込む要素について説明します。

## `img`要素

`img`要素は、画像を表す要素です。`src`属性で画像のURLを指定します。この属性は必須です。`img`要素で指定できる代表的な画像形式としては、PNG、GIF（アニメーションGIFを含む）、JPEG、SVGなどが挙げられます。

```
<img src="cat.png" alt="ねこのかわいい写真">
```

`src`属性の値としては、通常のURLの他に、データURLと呼ばれる`data:`スキームを先頭に付けたURL[^1]でも画像を表すことができます。Base64と呼ばれるエンコード方式[^2]を用いて画像データを英数字で表すものであり、HTMLに直接画像を埋め込むものです。

`alt`属性の値は、画像を処理できないか、読み込みが無効な場合に、等価なコンテンツを提供する、原則として必須の属性です。適切な値については、`alt`属性の節で検討します。

`srcset`属性で、画像候補を指定できます。詳細については、レスポンシブ画像の節で説明します。

[^1]: Fetch Standardで現在定義されています。

[^2]: Base64にはいくつかのバリエーションがありますが、ブラウザーで扱うものについては、Infra Standardで定義されています。

### `alt`属性の役割と原則

画像の代替テキスト（alternative text）または置換テキスト（replacement text）を表す`alt`属性は、ウェブアクセシビリティを考える上でもっとも重要な属性の1つとして挙げられます。

何らかの原因で画像が見れない―検索エンジンなどの機械がアクセスする、ネットワークが不調で画像が表示できない、環境等によりユーザーの視覚が十全に機能しない―場合、画像と等価な代替テキストは、画像にとって代わって、その画像の内容を表すことになります。

このことは言い換えると、画像の性質によってある程度代替テキストの内容が決定されることを意味します。と同時に、全く同じ内容の画像であっても、画像の文脈によって代替テキストの内容が変化するということも言えます。

代替テキストを記述するにあたっての考慮すべき原則は、2つあります。
1つは、「`alt`のテキストと画像を置き換えてもページの意味を変えない」ことです。これは言い換えると、画像の意味を補完するような値であってはならない、ということです。

<!--地図の例。
イメージとしては、 https://www.ginza-vd.com/wp-content/themes/vd/img/imgMap.gif このような画像でより抽象化した架空の地図を用意する -->

```
<p>
<img src="rough-map.png" alt="当社入居ビルまでの地図。九段下駅の6番出口から出て、靖国通りを西に進み、九段下の交差点を南に進んだ建物です。">
```

例えば、最寄りの駅から会社のビルまでの簡単な経路を示した略図をマークアップするならば、上記のように代替テキストを付与することが考えられるでしょう。略図には示していないコンビニエンスストアが、たとえビルのすぐ隣にあったとしても、そのことを代替テキストに含めてはなりません。略図にはない情報を付け足してまうと、画像と同等な代替テキストにはならないためです。

もう1つは、「`alt`属性の値は既に画像の横に文で提供される情報を繰り返すべきではない」ということです。

<!-- 地図の例2 -->
```
<p><img src="rough-map.png" alt="当社ビルまでの略図">
<p>当社入居ビルまでの地図。九段下駅の6番出口から出て、靖国通りを西に進み、九段下の交差点を南に進んだ建物です。</p>
```

前の例と同じ地図ですが、地の文で地図と同等な道順を示している場合、`alt`には地の文にある道順を記載せず、単にどのような画像かを記します。このように冗長な情報を省くことで、具体的にはスクリーンリーダーが同じ内容を二度読み上げることを防ぎます。文脈によって、代替テキストの内容は変化することがあることも念頭に置いておくとよいでしょう。

#### altの決定方針

例外を除いて、`alt`属性は省略してはいけません。また、装飾的な画像のような場合を除いて、等価な代替テキストを属性値に記述しなければなりません。

どのような場合に属性値を空にするのか(`alt=""`)、どのような代替テキストが望ましいか、属性そのものを省略するのはどのような場合かについての例は、WHATWGおよびW3CのHTML仕様のRequirements for providing text to act as an alternative for images[^3] [^4]でそれぞれ詳しく説明されています。また、アクセシビリティの観点からAn alt Decision Tree[^5]というW3Cによるリソースも存在します。それぞれ参考にするとよいでしょう。

[^3]: https://html.spec.whatwg.org/multipage/images.html#alt
[^4]: https://www.w3.org/TR/html/semantics-embedded-content.html#alt-text
[^5]: https://www.w3.org/WAI/tutorials/images/decision-tree/

`alt`属性の値として何らかの代替テキストを置くことができる場合に、その書き方については絶対的な正解というものは存在しません。画像を通してウェブページで言いたいことは、そのページのコンテキストに依存します。どのような意図でその画像が埋め込まれるのか、制作の意図をしっかりと把握した上で、代替テキストを記述することが求められます。


## レスポンシブ画像

`picture`要素や、`srcset`と`sizes`属性を使用することで、複数の画像リソースから最適な画像をユーザーエージェントに選択させることができるようになります。レスポンシブ画像を使うシーンというのは、次の4つに集約されるでしょう。

- 画像のレンダリングサイズが固定される前提で、デバイスピクセルによる画像の選択。解像度の高いデバイスで、より高解像度を画像が選択されます。
- ビューポートによる選択。ウィンドウの一定割合を画像で表示させたい場合が当てはまります。
- アートディレクションによる選択。これは、縦長のモバイルデバイスと、横長のデスクトップモニターとで表示する画像を切り替えたい場合が当てはまります。
- 画像フォーマットによる選択。例えば一部のユーザーエージェントでしかサポートされない、より画像ファイルが小さくなるような画像フォーマットを選択させたい場合が当てはまります。

最初の2つは`img`要素の`srcset`や`sizes`属性を用いて、後の2つは`picture`と`source`要素および`source`要素で`srcset`属性を用いて、レスポンシブ画像を実現します。

### デバイスピクセルによる選択例
<!-- HTML LS -->
```
<img src="/uploads/100-marie-lloyd.jpg"
     srcset="/uploads/150-marie-lloyd.jpg 1.5x, /uploads/200-marie-lloyd.jpg 2x"
     alt="" width="100" height="150">
```
複数の画像を選択するために、`x`記述子を用いて記述します。これにより、高いデバイスピクセル比を持つスクリーンで、より高解像度となる画像が選択されます。


### ビューポートによる選択例
<!-- HTML LSからのコピー -->
```
<img sizes="100vw" srcset="wolf-400.jpg 400w, wolf-800.jpg 800w, wolf-1600.jpg 1600w"
     src="wolf-400.jpg" alt="The rad wolf">
```
ユーザーエージェントは、指定されるw記述子と`sizes`属性で指定されるレンダリングサイズから各画像の効果的なピクセル密度を算出します。画面のピクセル密度、ズームレベル、ネットワークの状態などから、最適な画像をユーザーエージェントが選択します。

上記のコードの場合、例えば、320 CSSピクセル幅である場合、これは`wolf-400.jpg 1.25x, wolf-800.jpg 2.5x, wolf-1600.jpg 5x`に指定するのと等価になります。

互換性のために、URLの1つは`img`要素の`src`属性で指定されます。モダンなユーザーエージェントで、`srcset`属性が`w`記述子を使用する場合、`src`属性は無視されます。


### アートディレクションの例
<!-- https://dev.opera.com/articles/ja/responsive-images/ 改 -->
```
<picture>
  <source media="(min-width: 1024px)"
                srcset="fullshot.jpg">
  <img src="closeup.jpg" alt="Opera House">
</picture>
```
ブラウザーのウィンドウ幅が1024 CSSピクセル以上の場合、全景の写真（fullshot.jpg）が選択されます。ウインドウ幅がそれよりも小さい場合は、ズームアップされた写真（closeup.jpg）が選択されます。

### 画像フォーマットの出し分けの例

```
<picture>
 <source srcset="happy.webp" type="image/webp">
 <source srcset="happy.jxr" type="image/vnd.ms-photo">
 <img src="happy.jpg" alt="">
</picture>
```

この例ではブラウザーがWebPをサポートする場合はWebPを、そうでなければJPEG XR画像を、いずれもサポートしない場合はフォールバックとしてJPEGが選択されます。

<!--
参考リソース
https://www.html5rocks.com/ja/tutorials/responsive/picture-element/
https://dev.opera.com/articles/ja/responsive-images/
https://developer.mozilla.org/ja/docs/Web/HTML/Element/picture
https://developer.mozilla.org/ja/docs/Web/HTML/Element/source
-->

<!-- 画像だけ、というわけでもない -->
## `iframe`要素

`iframe`（インラインフレーム）要素は、現在表示しているページに別のHTML文書を埋め込むことができる要素です。

もっぱら、他のウェブ上のサービスからコードをそのままコピー＆ペーストで貼り付けることが多い要素かと思いますが、そのサービスから提供されるHTMLコードが文法上必ずしも正しいとは限りません。属性が廃止されていないかどうか確かめる必要はあるでしょう。もっともこれは、`iframe`要素に限った話ではなく、あらゆるサンプルコードに言えることではあります。

```とあるVTuber動画
<iframe width="560" height="315" src="https://www.youtube.com/embed/PyJOEt2nsGQ" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
```

例えば、上記は2019年10月に確認したYouTubeの埋め込みコードですが、`frameborder`属性は廃止されています。これは代わりにCSSで実現する必要があります。また、ウェブアクセシビリティの観点から、`title`属性で内容をラベル付けすることが望まれます。

`src`属性はリソースの存在するURLを指定します。ここではYouTubeの埋め込みプレーヤーのURLを指定しています。

`allow`属性はFeature policy仕様[^6]に基づいて、許可する機能やAPIを指定するものです。`allowfullscreen`属性は、全画面表示のAPI `requestFullscreen()`を許可するものです。属性と類似の属性として、Payment Request APIを許可する`allowpaymentrequest`とMedia Capture and Streamsを許可する`allowusermedia`があります。これらは、汎用的な`allow`属性に対して、特定の機能のみを許可する真偽属性です。

また、`srcdoc`属性でHTMLを直接埋め込むことも可能です。

[^6]: Feature Policy https://w3c.github.io/webappsec-feature-policy/

```LSからのコピー（改）
<iframe sandbox srcdoc="<p>ごはんを温めますか？"></iframe>
```

<!--
https://blog.jxck.io/entries/2018-03-08/feature-policy-permission-delegation.html
-->
`sandbox`属性を使用することで、コンテンツにJavaScriptやフォームの実行等の各種制限を加えることができます。空文字列として使用することで、最大限の制限を行います。定められたトークンを（複数の場合はスペース区切りで）属性値に指定することで、個別の制限を許可します。<!-- トークンを列挙する必要は…？ -->

<!-- https://www.jpcert.or.jp/research/HTML5-20131030.pdf -->

<!-- 以下の要素は、手短にする感じ…？ -->
<!-- とりあえずflashの例でごり押ししてみたが… -->
## `embed`要素

`embed`要素は外部の（典型的にはHTMLでない）アプリケーションやインタラクティブなコンテンツを埋め込むために使用するものです。具体的には、Flashプラグインのようなリソースを埋め込むために使用できます。

次のコードはFlashプラグインを用いるFlashの動画を埋め込む古典的な例です。
```
<embed src="movie.swf">
```

## `object`要素と`param`要素

`object`要素は、画像、別のHTML文書、プラグインで処理される外部リソースを表します。`img`、`iframe`、`video`、`audio`といった専門の要素で代用が可能なことが多いでしょう。

子要素に`param`要素を持つことができます。これにより、`object`要素にパラメーターを与えることができます。

次のコードはFlashプラグインを用いるFlashの動画を埋め込む古典的な例です。

```
<!-- oblect要素のみで指定 -->
<object data="movie.swf"
  type="application/x-shockwave-flash"></object>

<!-- param要素と併用で指定 -->
<object type="application/x-shockwave-flash">
  <param name=movie value="movie.swf">
</object>
```

## メディア要素

仕様では`video`要素および`audio`要素をまとめてメディア要素と呼びます。前者は映像を表し、後者は音声を表します。どちらの要素も、`source`要素を用いて複数の異なるフォーマットのリソースを指定できます。

``` video要素の例
<video controls src="https://archive.org/download/BigBuckBunny_124/Content/big_buck_bunny_720p_surround.mp4"
    poster="https://peach.blender.org/wp-content/uploads/title_anouncement.jpg?x11217"
    width="620">

このブラウザーは埋め込み動画に対応していません。
しかし、<a href="https://archive.org/details/BigBuckBunny_124">ダウンロード</a>
して好みの動画プレイヤーで見ることはできます。
</video>
```

```audio要素の例
<audio>
 <source src="foo.ogg" type="audio/ogg; codecs=vorbis"/>
 <source src="foo.mp3" type="audio/mpeg"/>
</audio>
```


### WebVTT

音声は聴覚に障害がある人にとって、映像は視覚に障害がある人にとって、ウェブアクセシビリティ上の懸念が存在します。この問題に対処する1つの方法として、WebVTT (Web Video Text Tracks)フォーマットと呼ばれる、時間指定のテキストトラック（字幕やキャプションなど）を表示するためのデータフォーマットを利用できます。

``` WebVTTの記述例（コードグリッドからのほぼ複写 （CC-BY 3.0）https://app.codegrid.net/entry/2017-webvtt-1）
WEBVTT

NOTE
これはコメントです。

my-cue-id-1
00:00.000 --> 00:05.000 line:90%
これは<b>WebVTT</b>による字幕です。
```
```こちらも複写
 <video>
    <!-- 読み込む動画ファイルの指定 -->
    <source src="movie.mp4" type="video/mp4">
    <!-- 読み込む字幕ファイルの指定（日本語） -->
    <track label="日本語" kind="captions" srclang="ja" src="movie-ja.vtt" type="text/vtt" default>
    <!-- 読み込む字幕ファイルの指定（英語） -->
    <track label="English" kind="captions" srclang="en" src="movie-en.vtt" type="text/vtt">
  </video>
```
このように指定することで、映像に字幕を付与できます。これにより、ウェブアクセシビリティを確保することができます。

## イメージマップ
イメージマップは、1つの画像上で、クリックする場所によって別々のリンクを割り当てることのできる機能です。`img`要素、`map`要素および`area`要素によって実現します。

```LSからのコピー（改）
<p>
 形状を選んでください:
 <img src="shapes.png" usemap="#shapes"
      alt="くり抜かれた赤い正方形、緑の円、青い三角形、十字型の黄色の星の4つの形状があります。">
 <map name="shapes">
  <area shape=rect coords="50,50,100,100"> <!-- 赤い正方形の穴 -->
  <area shape=rect coords="25,25,125,125" href="red.html" alt="赤い正方形">
  <area shape=circle coords="200,75,50" href="green.html" alt="緑の円">
  <area shape=poly coords="325,25,262,125,388,125" href="blue.html" alt="青い三角形">
  <area shape=poly coords="450,25,435,60,400,75,435,90,450,125,465,90,500,75,465,60"
        href="yellow.html" alt="黄色の星">
 </map>
</p>
```

`img`要素の`usemap`属性と、`map`要素の`name`属性とでイメージマップを関連付けます。`name`はイメージマップの名前になります。`usemap`属性値はハッシュ名による`name`への参照です。

`area`要素の`shape`属性は、イメージマップ内に作成する図形の種類を表し、`circle`、`poly`、`rect`、`default`の4つのキーワードから選択する列挙属性です。

`coords`属性は、イメージマップ内に作成する図形の座標を表す、CSS ピクセルで表されるリストです。指定する座標の数は、`shape`属性値によって変化します。

